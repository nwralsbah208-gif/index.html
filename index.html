<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Red Square VS Souls</title>
<style>
body{margin:0;background:#000;overflow:hidden;font-family:Tahoma}
canvas{display:block;margin:auto;background:#111}
#menu{
  position:fixed;top:0;left:0;width:100%;height:100%;
  background:#000;color:#fff;text-align:center;
}
.level{
  padding:10px;margin:5px;border:1px solid #555;
  display:inline-block;width:120px;cursor:pointer;
}
.locked{opacity:.3}
</style>
</head>
<body>

<div id="menu">
  <h1>üü• Red Square VS Souls</h1>
  <p>ÿßÿÆÿ™ÿ± ÿßŸÑŸÖÿ±ÿ≠ŸÑÿ©</p>
  <div id="levels"></div>
</div>

<canvas id="game" width="900" height="500"></canvas>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
const menu=document.getElementById("menu");
const levelsDiv=document.getElementById("levels");

let currentLevel=0;
let unlocked=1;

// ===== ÿßŸÑŸÑÿßÿπÿ® =====
const player={
  x:100,y:350,w:40,h:40,
  speed:4,hp:3,bullets:[]
};

// ===== ÿ™ÿ≠ŸÉŸÖ =====
const keys={};
onkeydown=e=>keys[e.key]=true;
onkeyup=e=>keys[e.key]=false;

// ===== ŸÖÿ±ÿßÿ≠ŸÑ =====
const levels=[
 {name:"ÿßŸÑÿ∏ŸÑ ÿßŸÑÿ∂ÿπŸäŸÅ",hp:20,spd:2,msg:"ÿ≥ŸàŸÅ ÿ£ÿØŸÖÿ±ŸÉ"},
 {name:"ÿßŸÑÿπŸäŸÜ ÿßŸÑÿ≠ŸÖÿ±ÿßÿ°",hp:30,spd:2.5,msg:"ÿ£ÿ±ÿßŸÉ"},
 {name:"ÿßŸÑŸÇÿßŸÅÿ≤",hp:40,spd:3,msg:"ŸÑŸÜ ÿ™Ÿáÿ±ÿ®"},
 {name:"ÿßŸÑÿ≠ÿßÿ±ŸÇ",hp:45,spd:3,msg:"ÿßÿ≠ÿ™ÿ±ŸÇ"},
 {name:"ÿßŸÑÿ≥ÿ±Ÿäÿπ",hp:50,spd:3.5,msg:"ÿ£ÿ≥ÿ±ÿπ ŸÖŸÜŸÉ"},
 {name:"ÿßŸÑÿµÿßŸÖÿ™",hp:55,spd:2.5,msg:"..."},
 {name:"ÿßŸÑŸÖÿ¨ŸÜÿ≠",hp:60,spd:4,msg:"ÿ£ÿ∑Ÿäÿ±"},
 {name:"ÿßŸÑŸÖÿØŸÖÿ±",hp:70,spd:3,msg:"ÿ≥ÿ£ŸÉÿ≥ÿ± ŸÉŸÑ ÿ¥Ÿäÿ°"},
 {name:"ÿßŸÑÿ≥ÿßŸÖ",hp:80,spd:3,msg:"ÿ≥ŸÖŸä ŸÇÿßÿ™ŸÑ"},
 {name:"ÿßŸÑÿ¥Ÿäÿ∑ÿßŸÜ",hp:90,spd:3.5,msg:"ÿßŸÑÿ¨ÿ≠ŸäŸÖ ŸäŸÜÿ™ÿ∏ÿ±ŸÉ"},
 {name:"ÿßŸÑÿ±Ÿàÿ≠ ÿßŸÑÿ≥ŸàÿØÿßÿ°",hp:100,spd:4,msg:"ŸÜŸáÿßŸäÿ™ŸÉ ŸÇÿ±Ÿäÿ®ÿ©"},
 {name:"ÿßŸÑÿ≠ÿßÿ±ÿ≥",hp:120,spd:3,msg:"ŸÑÿß ŸÖÿ±Ÿàÿ±"},
 {name:"ÿßŸÑŸÖŸÑŸÉ",hp:150,spd:3,msg:"ÿ£ŸÜÿß ÿßŸÑŸÜŸáÿßŸäÿ©"}
];

let enemy=null;
let souls=[];

// ===== ŸÇÿßÿ¶ŸÖÿ© =====
function drawMenu(){
  levelsDiv.innerHTML="";
  levels.forEach((l,i)=>{
    const d=document.createElement("div");
    d.className="level"+(i>=unlocked?" locked":"");
    d.textContent=`ŸÖÿ±ÿ≠ŸÑÿ© ${i+1}`;
    if(i<unlocked){
      d.onclick=()=>startLevel(i);
    }
    levelsDiv.appendChild(d);
  });
}
drawMenu();

// ===== ÿ®ÿØÿ° ÿßŸÑŸÖÿ±ÿ≠ŸÑÿ© =====
function startLevel(i){
  currentLevel=i;
  menu.style.display="none";
  player.hp=3;
  player.x=100;
  player.bullets=[];
  const l=levels[i];
  enemy={
    x:600,y:350,w:50,h:50,
    hp:l.hp,speed:l.spd,
    msg:l.msg, jump:0
  };
}

// ===== ÿ•ÿ∑ŸÑÿßŸÇ =====
function shoot(){
  player.bullets.push({x:player.x+40,y:player.y+20});
}

// ===== ÿ™ÿ≠ÿØŸäÿ´ =====
function update(){
  if(keys["ArrowLeft"])player.x-=player.speed;
  if(keys["ArrowRight"])player.x+=player.speed;
  if(keys["ArrowUp"])player.y-=player.speed;
  if(keys["ArrowDown"])player.y+=player.speed;
  if(keys[" "])shoot();

  // ÿ±ÿµÿßÿµ
  player.bullets.forEach(b=>b.x+=7);
  player.bullets=player.bullets.filter(b=>b.x<canvas.width);

  // ÿ∞ŸÉÿßÿ° ÿßŸÑŸàÿ≠ÿ¥
  if(enemy){
    enemy.x+=enemy.x>player.x?-enemy.speed:enemy.speed;
    if(Math.random()<0.01)enemy.jump=20;
    if(enemy.jump>0){enemy.y-=2;enemy.jump--}
    if(enemy.y<350)enemy.y+=2;

    // ÿ™ÿµÿßÿØŸÖ
    if(
      player.x<enemy.x+enemy.w &&
      player.x+player.w>enemy.x &&
      player.y<enemy.y+enemy.h &&
      player.y+player.h>enemy.y
    ){
      player.hp--;
      player.x=50;
      if(player.hp<=0){
        menu.style.display="block";
        drawMenu();
      }
    }

    // ÿ•ÿµÿßÿ®ÿ©
    player.bullets.forEach(b=>{
      if(b.x>enemy.x && b.x<enemy.x+enemy.w &&
         b.y>enemy.y && b.y<enemy.y+enemy.h){
        enemy.hp--;
        b.x=9999;
      }
    });

    // ŸÖŸàÿ™ ÿßŸÑŸàÿ≠ÿ¥
    if(enemy.hp<=0){
      souls.push({x:enemy.x,y:enemy.y,life:100});
      enemy=null;
      if(unlocked<levels.length)unlocked++;
      menu.style.display="block";
      drawMenu();
    }
  }

  // ÿßŸÑÿ£ÿ±Ÿàÿßÿ≠
  souls.forEach(s=>{s.y-=1;s.life--});
  souls=souls.filter(s=>s.life>0);
}

// ===== ÿ±ÿ≥ŸÖ =====
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // ŸÑÿßÿπÿ®
  ctx.fillStyle="red";
  ctx.fillRect(player.x,player.y,player.w,player.h);

  // ŸÇŸÑŸàÿ®
  for(let i=0;i<player.hp;i++){
    ctx.fillStyle="pink";
    ctx.fillRect(20+i*25,20,20,20);
  }

  // ÿ±ÿµÿßÿµ
  ctx.fillStyle="yellow";
  player.bullets.forEach(b=>ctx.fillRect(b.x,b.y,6,3));

  // Ÿàÿ≠ÿ¥
  if(enemy){
    ctx.fillStyle="darkgreen";
    ctx.fillRect(enemy.x,enemy.y,enemy.w,enemy.h);

    // ÿπŸäŸàŸÜ
    ctx.fillStyle="white";
    ctx.fillRect(enemy.x+10,enemy.y+10,5,5);
    ctx.fillRect(enemy.x+30,enemy.y+10,5,5);

    // ŸÉŸÑÿßŸÖ
    ctx.fillStyle="red";
    ctx.fillText(enemy.msg,enemy.x-10,enemy.y-10);
  }

  // ÿ±Ÿàÿ≠
  souls.forEach(s=>{
    ctx.fillStyle="rgba(0,255,255,.5)";
    ctx.beginPath();
    ctx.arc(s.x,s.y,15,0,Math.PI*2);
    ctx.fill();
  });
}

// ===== ÿ≠ŸÑŸÇÿ© =====
function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
  <div id="controls">
  <button ontouchstart="keys['ArrowLeft']=true" ontouchend="keys['ArrowLeft']=false">‚¨ÖÔ∏è</button>
  <button ontouchstart="keys['ArrowUp']=true" ontouchend="keys['ArrowUp']=false">‚¨ÜÔ∏è</button>
  <button ontouchstart="keys['ArrowDown']=true" ontouchend="keys['ArrowDown']=false">‚¨áÔ∏è</button>
  <button ontouchstart="keys['ArrowRight']=true" ontouchend="keys['ArrowRight']=false">‚û°Ô∏è</button>
  </div>
  <style>
#controls{
  position:fixed;
  bottom:20px;
  left:20px;
  z-index:999;
}
#controls button{
  width:60px;
  height:60px;
  font-size:24px;
  margin:5px;
  border-radius:12px;
  border:none;
  background:#222;
  color:white;
}
  </style>
  <button id="fireBtn">üî•</button>
  <style>
#fireBtn{
  position:fixed;
  bottom:30px;
  right:30px;
  width:80px;
  height:80px;
  border-radius:50%;
  font-size:30px;
  background:red;
  color:white;
  border:none;
  z-index:999;
}
  </style>
  <script>
document.getElementById("fireBtn").addEventListener("touchstart", ()=>{
  shoot();
});
  </script>
</html>
