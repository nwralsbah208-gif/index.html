<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ÿßŸÑŸÖŸÉÿπÿ® ÿßŸÑŸÖÿ≠ÿßÿ±ÿ® - Cube Warrior</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-user-select: none;
            user-select: none;
            touch-action: manipulation;
        }

        body {
            background: #000;
            color: white;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
        }

        #gameContainer {
            position: relative;
            width: 100%;
            height: 100%;
            background: #111;
        }

        #gameCanvas {
            display: block;
            background: #111;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        #debugInfo {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            color: #0f0;
            z-index: 1000;
            display: none;
        }

        /* HUD */
        #hud {
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            z-index: 100;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            pointer-events: none;
        }

        .hud-item {
            background: rgba(0, 0, 0, 0.7);
            padding: 8px 15px;
            border-radius: 20px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            backdrop-filter: blur(5px);
        }

        .hud-icon {
            font-size: 18px;
        }

        .hud-value {
            font-weight: bold;
            color: #ffcc00;
        }

        .bar-container {
            width: 120px;
            height: 10px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            overflow: hidden;
            margin-left: 10px;
        }

        .bar-fill {
            height: 100%;
            transition: width 0.3s;
        }

        #healthBar { background: linear-gradient(to right, #ff0000, #ff6666); }
        #shieldBar { background: linear-gradient(to right, #0088ff, #66aaff); }
        #xpBar { background: linear-gradient(to right, #00ff00, #66ff66); }
        #manaBar { background: linear-gradient(to right, #aa00ff, #cc66ff); }

        #waveInfo {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            padding: 10px 20px;
            border-radius: 15px;
            border: 2px solid #ffcc00;
            text-align: center;
            font-weight: bold;
            z-index: 100;
        }

        #comboDisplay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 60px;
            font-weight: bold;
            color: #ffcc00;
            text-shadow: 0 0 20px #ff9900;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
        }

        #playerPosition {
            position: absolute;
            top: 100px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            color: #0ff;
            z-index: 1000;
        }

        #controls {
            position: absolute;
            bottom: 20px;
            left: 0;
            width: 100%;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            z-index: 100;
        }

        .joystick-area {
            width: 160px;
            height: 160px;
            position: relative;
            background: rgba(100, 100, 255, 0.1);
            border-radius: 50%;
            border: 2px solid rgba(100, 100, 255, 0.3);
        }

        .joystick-handle {
            position: absolute;
            width: 70px;
            height: 70px;
            background: rgba(100, 100, 255, 0.7);
            border-radius: 50%;
            border: 3px solid rgba(150, 150, 255, 0.9);
            transform: translate(-50%, -50%);
            top: 50%;
            left: 50%;
            box-shadow: 0 0 15px rgba(100, 100, 255, 0.5);
            transition: all 0.1s;
        }

        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .action-row {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
        }

        .action-btn {
            width: 80px;
            height: 80px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            color: white;
            border: 3px solid;
            box-shadow: 0 0 20px currentColor;
            background: rgba(0, 0, 0, 0.6);
            transition: all 0.1s;
            cursor: pointer;
            user-select: none;
            -webkit-user-select: none;
            touch-action: manipulation;
        }

        .action-btn:active {
            transform: scale(0.9);
            filter: brightness(1.3);
        }

        #fireBtn { border-color: #ff3333; box-shadow: 0 0 20px #ff3333; }
        #ability1Btn { border-color: #ff9900; box-shadow: 0 0 20px #ff9900; }
        #ability2Btn { border-color: #00aaff; box-shadow: 0 0 20px #00aaff; }
        #ability3Btn { border-color: #aa00ff; box-shadow: 0 0 20px #aa00ff; }
        #menuBtn { border-color: #cccccc; box-shadow: 0 0 20px #cccccc; font-size: 24px; }

        /* ÿßŸÑŸÇŸàÿßÿ¶ŸÖ */
        .menu {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            padding: 30px;
            border-radius: 25px;
            border: 4px solid;
            min-width: 350px;
            max-width: 90%;
            max-height: 80%;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .menu-header {
            text-align: center;
            margin-bottom: 25px;
            font-size: 28px;
            color: #ffcc00;
            text-shadow: 0 0 10px #ff9900;
        }

        .menu-content {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .menu-item {
            background: rgba(50, 50, 100, 0.5);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            border: 2px solid #4444ff;
            cursor: pointer;
            transition: all 0.2s;
        }

        .menu-item:hover {
            background: rgba(70, 70, 150, 0.7);
            transform: translateY(-3px);
        }

        .item-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }

        .item-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .item-price {
            color: #ffcc00;
            font-size: 14px;
        }

        .menu-btn {
            background: linear-gradient(45deg, #4444ff, #222288);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 10px;
            font-size: 18px;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
            transition: all 0.2s;
        }

        .menu-btn:hover {
            background: linear-gradient(45deg, #5555ff, #333399);
        }

        /* ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿÆÿßÿµÿ© */
        .damage-popup {
            position: absolute;
            color: #ff0000;
            font-weight: bold;
            font-size: 20px;
            text-shadow: 2px 2px 0 #000;
            pointer-events: none;
            z-index: 500;
            animation: floatUp 1s ease-out forwards;
        }

        @keyframes floatUp {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            50% { opacity: 1; transform: translateY(-25px) scale(1.2); }
            100% { opacity: 0; transform: translateY(-50px) scale(1); }
        }

        /* Mini-map */
        #minimap {
            position: absolute;
            bottom: 200px;
            right: 20px;
            width: 150px;
            height: 150px;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #00aaff;
            border-radius: 10px;
            z-index: 100;
            overflow: hidden;
        }

        /* Loading Screen */
        #loadingScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .loading-text {
            font-size: 24px;
            color: #ffcc00;
            margin-top: 20px;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { opacity: 0.5; }
            50% { opacity: 1; }
            100% { opacity: 0.5; }
        }

        /* Tutorial */
        #tutorial {
            position: absolute;
            bottom: 200px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #00ff00;
            text-align: center;
            max-width: 300px;
            z-index: 100;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas"></canvas>
        
        <!-- ÿ¥ÿßÿ¥ÿ© ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ -->
        <div id="loadingScreen">
            <div style="font-size: 40px; color: #ffcc00;">üéÆ ÿßŸÑŸÖŸÉÿπÿ® ÿßŸÑŸÖÿ≠ÿßÿ±ÿ®</div>
            <div class="loading-text">ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÑÿπÿ®ÿ©...</div>
        </div>

        <!-- HUD -->
        <div id="hud">
            <div class="hud-item">
                <span class="hud-icon">‚ù§Ô∏è</span>
                <span class="hud-value" id="healthText">100</span>
                <div class="bar-container">
                    <div id="healthBar" class="bar-fill" style="width: 100%"></div>
                </div>
            </div>
            
            <div class="hud-item">
                <span class="hud-icon">üõ°Ô∏è</span>
                <span class="hud-value" id="shieldText">0</span>
                <div class="bar-container">
                    <div id="shieldBar" class="bar-fill" style="width: 0%"></div>
                </div>
            </div>
            
            <div class="hud-item">
                <span class="hud-icon">‚≠ê</span>
                <span class="hud-value" id="levelText">1</span>
                <div class="bar-container">
                    <div id="xpBar" class="bar-fill" style="width: 0%"></div>
                </div>
            </div>
            
            <div class="hud-item">
                <span class="hud-icon">üîã</span>
                <span class="hud-value" id="manaText">100</span>
                <div class="bar-container">
                    <div id="manaBar" class="bar-fill" style="width: 100%"></div>
                </div>
            </div>
            
            <div class="hud-item">
                <span class="hud-icon">üí∞</span>
                <span class="hud-value" id="coinsText">0</span>
            </div>
            
            <div class="hud-item">
                <span class="hud-icon">üíé</span>
                <span class="hud-value" id="gemsText">0</span>
            </div>
            
            <div class="hud-item">
                <span class="hud-icon">‚öîÔ∏è</span>
                <span class="hud-value" id="damageText">10</span>
            </div>
            
            <div class="hud-item">
                <span class="hud-icon">üî•</span>
                <span class="hud-value" id="comboCounter">0</span>
            </div>
        </div>

        <!-- ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ™ÿµÿ≠Ÿäÿ≠ -->
        <div id="debugInfo"></div>
        <div id="playerPosition"></div>
        <div id="waveInfo">ÿßŸÑŸÖŸàÿ¨ÿ© 1</div>
        <div id="comboDisplay"></div>
        <div id="minimap"></div>
        
        <!-- ÿßŸÑÿ™ÿπŸÑŸäŸÖÿßÿ™ -->
        <div id="tutorial">
            üéÆ ÿ≠ÿ±ŸÉ ÿßŸÑÿ¨ŸàŸäÿ≥ÿ™ŸäŸÉ ŸÑŸÑÿ™ÿ≠ÿ±ŸÉ<br>
            üî• ÿßÿ∂ÿ∫ÿ∑ ŸÑÿ•ÿ∑ŸÑÿßŸÇ ÿßŸÑŸÜÿßÿ±<br>
            ‚ö° ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑŸÖŸáÿßÿ±ÿßÿ™
        </div>

        <!-- ÿπŸÜÿßÿµÿ± ÿßŸÑÿ™ÿ≠ŸÉŸÖ -->
        <div id="controls">
            <div class="joystick-area">
                <div class="joystick-handle" id="movementJoystick"></div>
            </div>
            
            <div class="action-buttons">
                <div class="action-row">
                    <div id="ability3Btn" class="action-btn">‚ú®</div>
                    <div id="ability2Btn" class="action-btn">üí£</div>
                </div>
                <div class="action-row">
                    <div id="menuBtn" class="action-btn">‚ò∞</div>
                    <div id="fireBtn" class="action-btn">üî•</div>
                    <div id="ability1Btn" class="action-btn">‚ö°</div>
                </div>
            </div>
        </div>

        <!-- ŸÇŸàÿßÿ¶ŸÖ -->
        <div id="shopMenu" class="menu">
            <div class="menu-header">üè™ ŸÖÿ™ÿ¨ÿ± ÿßŸÑÿ£ÿ≥ŸÑÿ≠ÿ©</div>
            <div id="shopItems" class="menu-content"></div>
            <button id="closeShop" class="menu-btn">ÿ•ÿ∫ŸÑÿßŸÇ</button>
        </div>

        <div id="pauseMenu" class="menu">
            <div class="menu-header">‚è∏ ÿßŸÑŸÑÿπÿ®ÿ© ŸÖÿ™ŸàŸÇŸÅÿ©</div>
            <button id="resumeBtn" class="menu-btn">ÿßÿ≥ÿ™ÿ¶ŸÜÿßŸÅ ÿßŸÑŸÑÿπÿ®</button>
            <button id="restartBtn" class="menu-btn">ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ™ÿ¥ÿ∫ŸäŸÑ</button>
            <button id="quitBtn" class="menu-btn">ÿßŸÑÿÆÿ±Ÿàÿ¨</button>
        </div>
    </div>

    <script>
        // ========== ÿßŸÑÿ™ŸáŸäÿ¶ÿ© ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ© ==========
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ£ŸÜ ÿßŸÑŸÉÿßŸÜŸÅÿßÿ≥ Ÿäÿ£ÿÆÿ∞ ÿ≠ÿ¨ŸÖ ÿßŸÑÿ¥ÿßÿ¥ÿ© ÿ®ÿßŸÑŸÉÿßŸÖŸÑ
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            console.log(`Canvas resized to: ${canvas.width}x${canvas.height}`);
        }
        
        // ÿßÿ≥ÿ™ÿØÿπÿßÿ° resize ŸÖÿ®ÿßÿ¥ÿ±ÿ© ÿπŸÜÿØ ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ
        resizeCanvas();

        // ========== ŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ÿßŸÑŸÜÿ∏ÿßŸÖ ==========
        let game = {
            running: true,
            paused: false,
            time: 0,
            score: 0,
            coins: 0,
            gems: 0,
            wave: 1,
            kills: 0,
            combo: 0,
            maxCombo: 0,
            comboTime: 0,
            cameraX: 0,
            cameraY: 0,
            gameStarted: false
        };

        // ========== ÿßŸÑŸÑÿßÿπÿ® (ÿßŸÑŸÖŸÉÿπÿ®) ==========
        let player = {
            x: 0,
            y: 0,
            size: 30,
            color: '#ff3333',
            health: 100,
            maxHealth: 100,
            shield: 0,
            maxShield: 100,
            mana: 100,
            maxMana: 100,
            speed: 5,
            damage: 10,
            level: 1,
            xp: 0,
            xpToNext: 100,
            direction: 0,
            rotation: 0,
            baseSpeed: 5,
            
            // ÿßŸÑÿ≥ŸÑÿßÿ≠
            weapon: {
                type: 'pistol',
                name: 'ŸÖÿ≥ÿØÿ≥',
                damage: 10,
                fireRate: 300,
                range: 400,
                ammo: 30,
                maxAmmo: 30,
                reloadTime: 1000,
                color: '#ffff00',
                bulletSize: 4,
                bulletSpeed: 8,
                spread: 0.1,
                piercing: 0,
                explosive: false,
                lastShot: 0,
                reloading: false
            },
            
            // ÿßŸÑŸÖŸáÿßÿ±ÿßÿ™
            abilities: [
                { id: 'dash', name: 'ÿßŸÜÿØŸÅÿßÿπ', cooldown: 3000, lastUsed: 0, active: false },
                { id: 'shield', name: 'ÿØÿ±ÿπ', cooldown: 8000, lastUsed: 0, active: false, duration: 5000 },
                { id: 'heal', name: 'ÿ¥ŸÅÿßÿ°', cooldown: 10000, lastUsed: 0 },
                { id: 'bomb', name: 'ŸÇŸÜÿ®ŸÑÿ©', cooldown: 5000, lastUsed: 0 }
            ],
            
            // ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™
            stats: {
                critChance: 0.05,
                critDamage: 2.0,
                lifesteal: 0.0,
                dodge: 0.05,
                accuracy: 0.95,
                fireRateMultiplier: 1.0,
                damageMultiplier: 1.0,
                speedMultiplier: 1.0,
                areaDamage: 0,
                poisonDamage: 0,
                fireDamage: 0,
                iceDamage: 0,
                lightningDamage: 0
            }
        };

        // ========== ÿ£ŸÜŸàÿßÿπ ÿßŸÑŸàÿ≠Ÿàÿ¥ ==========
        const monsters = {
            zombie: { name: 'ÿ≤ŸàŸÖÿ®Ÿä', hp: 50, speed: 1.5, damage: 5, color: '#00aa00', size: 25, xp: 10, coins: 5 },
            skeleton: { name: 'ŸáŸäŸÉŸÑ ÿπÿ∏ŸÖŸä', hp: 40, speed: 2.0, damage: 8, color: '#cccccc', size: 24, xp: 12, coins: 6 },
            slime: { name: 'Ÿàÿ≠ŸÑ', hp: 30, speed: 1.0, damage: 3, color: '#00ff00', size: 22, xp: 8, coins: 3 }
        };

        // ========== ÿ£ŸÜŸàÿßÿπ ÿßŸÑÿ£ÿ≥ŸÑÿ≠ÿ© ==========
        const weapons = {
            pistol: { name: 'ŸÖÿ≥ÿØÿ≥', damage: 10, fireRate: 300, range: 400, ammo: 30, color: '#ffff00', bulletSpeed: 8 },
            shotgun: { name: 'ÿ®ŸÜÿØŸÇŸäÿ© ÿµŸäÿØ', damage: 25, fireRate: 800, range: 200, ammo: 8, color: '#ff9900', bulletSpeed: 6, spread: 0.3 }
        };

        // ========== ŸÖÿµŸÅŸàŸÅÿßÿ™ ÿßŸÑŸÑÿπÿ®ÿ© ==========
        let enemies = [];
        let bullets = [];
        let particles = [];
        let pickups = [];

        // ========== ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ¨ŸàŸäÿ≥ÿ™ŸäŸÉ ==========
        const joystick = {
            x: 0,
            y: 0,
            dx: 0,
            dy: 0,
            active: false,
            maxDistance: 60
        };

        // ========== ÿßŸÑÿ™ŸáŸäÿ¶ÿ© ==========
        function init() {
            console.log("ÿ¨ÿßÿ±Ÿä ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑŸÑÿπÿ®ÿ©...");
            
            // ÿ•ÿÆŸÅÿßÿ° ÿ¥ÿßÿ¥ÿ© ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ
            setTimeout(() => {
                document.getElementById('loadingScreen').style.display = 'none';
                game.gameStarted = true;
                console.log("ÿßŸÑŸÑÿπÿ®ÿ© ÿ®ÿØÿ£ÿ™!");
                
                // ÿ•ÿÆŸÅÿßÿ° ÿßŸÑÿ™ÿπŸÑŸäŸÖÿßÿ™ ÿ®ÿπÿØ 5 ÿ´ŸàÿßŸÜŸä
                setTimeout(() => {
                    document.getElementById('tutorial').style.opacity = '0';
                    setTimeout(() => {
                        document.getElementById('tutorial').style.display = 'none';
                    }, 1000);
                }, 5000);
            }, 2000);
            
            // Ÿàÿ∂ÿπ ÿßŸÑŸÑÿßÿπÿ® ŸÅŸä ŸÖŸÜÿ™ÿµŸÅ ÿßŸÑÿ¥ÿßÿ¥ÿ©
            player.x = canvas.width / 2;
            player.y = canvas.height / 2;
            
            console.log(`ŸÖŸàŸÇÿπ ÿßŸÑŸÑÿßÿπÿ®: x=${player.x}, y=${player.y}`);
            
            // ÿ™ÿ≠ÿØŸäÿ´ HUD
            updateHUD();
            
            // ÿ•ŸÜÿ¥ÿßÿ° ÿ®ÿπÿ∂ ÿßŸÑŸàÿ≠Ÿàÿ¥
            spawnEnemies(5);
            
            // ÿ®ÿØÿ° ÿßŸÑŸÑÿπÿ®ÿ©
            gameLoop();
        }

        function spawnEnemies(count) {
            for (let i = 0; i < count; i++) {
                const angle = Math.random() * Math.PI * 2;
                const distance = 200 + Math.random() * 300;
                const x = player.x + Math.cos(angle) * distanc
