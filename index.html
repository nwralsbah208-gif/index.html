<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>ğŸ‘‘ Ø§Ù„ÙˆÙ„Ø¯ Ø§Ù„Ù…Ù„ÙƒÙŠ - Ø¬Ø±Ø§ÙÙŠÙƒØ³ Ø®Ø§Ø±Ù‚ 10X</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        body {
            background: #000;
            overflow: hidden;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            height: 100vh;
            width: 100vw;
            color: white;
            cursor: none;
        }

        #gameContainer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            filter: contrast(1.2) brightness(1.1);
        }

        #ui {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }

        /* HUD Ø®Ø§Ø±Ù‚ */
        #hud {
            position: absolute;
            top: 25px;
            left: 25px;
            right: 25px;
            display: flex;
            justify-content: space-between;
            gap: 20px;
            flex-wrap: wrap;
        }

        .hud-card {
            background: linear-gradient(145deg, rgba(0, 0, 0, 0.95), rgba(20, 20, 40, 0.95));
            backdrop-filter: blur(25px) saturate(180%);
            border: 3px solid;
            border-image: linear-gradient(45deg, #3498db, #2ecc71, #9b59b6, #e74c3c) 1;
            border-radius: 25px;
            padding: 25px 35px;
            min-width: 200px;
            box-shadow: 
                0 15px 50px rgba(0, 0, 0, 0.8),
                0 0 0 1px rgba(255, 255, 255, 0.1),
                inset 0 0 30px rgba(52, 152, 219, 0.4);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }

        .hud-card::before {
            content: '';
            position: absolute;
            top: -150%;
            left: -150%;
            width: 400%;
            height: 400%;
            background: linear-gradient(
                45deg,
                transparent 25%,
                rgba(52, 152, 219, 0.15) 50%,
                transparent 75%
            );
            animation: shine 4s infinite linear;
        }

        @keyframes shine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .hud-title {
            background: linear-gradient(90deg, #3498db, #2ecc71);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-size: 22px;
            margin-bottom: 15px;
            font-weight: 800;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 0 2px 10px rgba(52, 152, 219, 0.3);
            position: relative;
            z-index: 1;
        }

        .hud-value {
            font-size: 48px;
            font-weight: 900;
            text-align: center;
            background: linear-gradient(90deg, #ffffff, #f1c40f);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 
                0 0 30px rgba(255, 255, 255, 0.7),
                0 0 60px rgba(52, 152, 219, 0.5),
                0 0 90px rgba(46, 204, 113, 0.3);
            position: relative;
            z-index: 1;
            animation: pulse 2s infinite alternate;
        }

        @keyframes pulse {
            0% { text-shadow: 0 0 20px rgba(255, 255, 255, 0.7); }
            100% { text-shadow: 0 0 40px rgba(52, 152, 219, 0.9), 0 0 80px rgba(46, 204, 113, 0.6); }
        }

        /* Ø§Ù„Ø¬ÙˆÙŠØ³ØªÙŠÙƒ Ø§Ù„Ø®Ø§Ø±Ù‚ */
        #joystickArea {
            position: absolute;
            bottom: 50px;
            left: 50px;
            width: 280px;
            height: 280px;
            pointer-events: auto;
            z-index: 1001;
            filter: drop-shadow(0 20px 40px rgba(0, 0, 0, 0.6));
        }

        .joystick-outer {
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(
                circle at center,
                rgba(52, 152, 219, 0.4) 0%,
                rgba(41, 128, 185, 0.2) 40%,
                rgba(23, 104, 165, 0.1) 70%,
                transparent 100%
            );
            border-radius: 50%;
            border: 4px solid rgba(255, 255, 255, 0.6);
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.7),
                inset 0 0 40px rgba(52, 152, 219, 0.5),
                0 0 0 2px rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(15px);
            animation: rotateGlow 10s infinite linear;
        }

        @keyframes rotateGlow {
            0% { box-shadow: 0 20px 60px rgba(0, 0, 0, 0.7), inset 0 0 40px rgba(52, 152, 219, 0.5); }
            25% { box-shadow: 0 20px 60px rgba(0, 0, 0, 0.7), inset 0 0 40px rgba(46, 204, 113, 0.5); }
            50% { box-shadow: 0 20px 60px rgba(0, 0, 0, 0.7), inset 0 0 40px rgba(155, 89, 182, 0.5); }
            75% { box-shadow: 0 20px 60px rgba(0, 0, 0, 0.7), inset 0 0 40px rgba(231, 76, 60, 0.5); }
            100% { box-shadow: 0 20px 60px rgba(0, 0, 0, 0.7), inset 0 0 40px rgba(52, 152, 219, 0.5); }
        }

        .joystick-inner {
            position: absolute;
            width: 120px;
            height: 120px;
            background: linear-gradient(
                145deg,
                #3498db 0%,
                #2980b9 25%,
                #1f6396 50%,
                #2980b9 75%,
                #3498db 100%
            );
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border: 5px solid white;
            box-shadow: 
                0 15px 40px rgba(0, 0, 0, 0.6),
                inset 0 0 30px rgba(255, 255, 255, 0.4),
                0 0 0 3px rgba(52, 152, 219, 0.5);
            cursor: move;
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 1002;
        }

        .joystick-inner:active {
            transform: translate(-50%, -50%) scale(0.9);
            box-shadow: 
                0 10px 30px rgba(0, 0, 0, 0.5),
                inset 0 0 50px rgba(255, 255, 255, 0.5),
                0 0 0 5px rgba(52, 152, 219, 0.8);
        }

        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø®Ø§Ø±Ù‚Ø© */
        #actionPanel {
            position: absolute;
            bottom: 60px;
            right: 60px;
            display: flex;
            flex-direction: column;
            gap: 35px;
            pointer-events: auto;
            z-index: 1001;
        }

        .action-btn {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            border: 5px solid white;
            color: white;
            font-size: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            user-select: none;
            position: relative;
            overflow: hidden;
            box-shadow: 
                0 20px 50px rgba(0, 0, 0, 0.8),
                inset 0 0 40px rgba(255, 255, 255, 0.3);
            filter: drop-shadow(0 10px 20px rgba(0, 0, 0, 0.5));
        }

        .action-btn::before {
            content: '';
            position: absolute;
            top: -100%;
            left: -100%;
            width: 300%;
            height: 300%;
            background: linear-gradient(
                45deg,
                transparent 30%,
                rgba(255, 255, 255, 0.6) 50%,
                transparent 70%
            );
            transform: rotate(45deg);
            animation: btnShine 3s infinite linear;
        }

        @keyframes btnShine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .action-btn:active {
            transform: scale(0.85);
            filter: brightness(1.3) drop-shadow(0 0 30px currentColor);
        }

        #jumpBtn {
            background: linear-gradient(
                145deg,
                #2ecc71 0%,
                #27ae60 33%,
                #219955 66%,
                #2ecc71 100%
            );
            border-color: #2ecc71;
        }

        #attackBtn {
            background: linear-gradient(
                145deg,
                #e74c3c 0%,
                #c0392b 33%,
                #a93226 66%,
                #e74c3c 100%
            );
            border-color: #e74c3c;
        }

        #specialBtn {
            background: linear-gradient(
                145deg,
                #9b59b6 0%,
                #8e44ad 33%,
                #7d3c98 66%,
                #9b59b6 100%
            );
            border-color: #9b59b6;
        }

        #danceBtn {
            background: linear-gradient(
                145deg,
                #f1c40f 0%,
                #f39c12 33%,
                #e67e22 66%,
                #f1c40f 100%
            );
            border-color: #f1c40f;
        }

        /* Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ø§Ø±Ù‚Ø© */
        #loadingScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                135deg,
                #0c2461 0%,
                #1e3799 33%,
                #0c2461 66%,
                #1a237e 100%
            );
            background-size: 400% 400%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            z-index: 2000;
            font-size: 32px;
            animation: gradientBG 10s ease infinite;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .loader-container {
            position: relative;
            width: 200px;
            height: 200px;
            margin-bottom: 60px;
        }

        .loader-ring {
            position: absolute;
            width: 100%;
            height: 100%;
            border: 12px solid transparent;
            border-radius: 50%;
            animation: spin 2.5s linear infinite;
        }

        .loader-ring:nth-child(1) {
            border-top: 12px solid #3498db;
            animation-delay: 0s;
            filter: drop-shadow(0 0 20px #3498db);
        }

        .loader-ring:nth-child(2) {
            border-right: 12px solid #2ecc71;
            animation-delay: 0.3s;
            filter: drop-shadow(0 0 20px #2ecc71);
        }

        .loader-ring:nth-child(3) {
            border-bottom: 12px solid #e74c3c;
            animation-delay: 0.6s;
            filter: drop-shadow(0 0 20px #e74c3c);
        }

        .loader-ring:nth-child(4) {
            border-left: 12px solid #9b59b6;
            animation-delay: 0.9s;
            filter: drop-shadow(0 0 20px #9b59b6);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); filter: blur(0px); }
            50% { filter: blur(5px); }
            100% { transform: rotate(360deg); filter: blur(0px); }
        }

        .progress-container {
            width: 600px;
            max-width: 80%;
            height: 35px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            margin-top: 60px;
            overflow: hidden;
            border: 3px solid rgba(255, 255, 255, 0.2);
            position: relative;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(
                90deg,
                #3498db 0%,
                #2ecc71 25%,
                #e74c3c 50%,
                #9b59b6 75%,
                #f1c40f 100%
            );
            background-size: 200% 100%;
            border-radius: 17px;
            width: 0%;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            animation: gradientMove 3s infinite linear;
        }

        @keyframes gradientMove {
            0% { background-position: 0% 0%; }
            100% { background-position: 200% 0%; }
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                90deg,
                transparent 30%,
                rgba(255, 255, 255, 0.6) 50%,
                transparent 70%
            );
            animation: progressShine 2s infinite linear;
        }

        @keyframes progressShine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        #loadingDetails {
            margin-top: 30px;
            font-size: 24px;
            text-align: center;
            text-shadow: 0 0 20px rgba(52, 152, 219, 0.7);
            background: linear-gradient(90deg, #3498db, #2ecc71, #e74c3c, #9b59b6);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: bold;
            animation: textGlow 2s infinite alternate;
        }

        @keyframes textGlow {
            0% { text-shadow: 0 0 10px rgba(52, 152, 219, 0.5); }
            100% { text-shadow: 0 0 30px rgba(52, 152, 219, 0.9), 0 0 50px rgba(46, 204, 113, 0.7); }
        }

        /* Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙˆÙ…Ø¨Ùˆ Ø§Ù„Ø®Ø§Ø±Ù‚ */
        #comboDisplay {
            position: absolute;
            top: 180px;
            right: 40px;
            background: linear-gradient(145deg, rgba(231, 76, 60, 0.95), rgba(192, 57, 43, 0.95));
            padding: 25px 40px;
            border-radius: 20px;
            border: 4px solid #e74c3c;
            font-size: 36px;
            font-weight: 900;
            color: white;
            text-shadow: 0 0 20px rgba(231, 76, 60, 0.8);
            animation: comboPulse 0.8s infinite alternate;
            display: none;
            backdrop-filter: blur(15px);
            box-shadow: 
                0 15px 40px rgba(231, 76, 60, 0.4),
                0 0 0 2px rgba(255, 255, 255, 0.2);
            transform-origin: center;
        }

        @keyframes comboPulse {
            0% { transform: scale(1) rotate(-2deg); box-shadow: 0 10px 30px rgba(231, 76, 60, 0.6); }
            100% { transform: scale(1.1) rotate(2deg); box-shadow: 0 20px 50px rgba(231, 76, 60, 0.9); }
        }

        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø´Ø§Ø´Ø© */
        #effectOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 999;
            opacity: 0;
            transition: opacity 0.5s;
            mix-blend-mode: screen;
        }

        /* Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØµØ­ÙŠØ­ */
        #debugInfo {
            position: absolute;
            top: 30px;
            right: 30px;
            background: linear-gradient(145deg, rgba(0, 0, 0, 0.8), rgba(20, 40, 60, 0.9));
            padding: 20px;
            border-radius: 15px;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            color: #2ecc71;
            border: 2px solid #2ecc71;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            line-height: 1.6;
            display: block;
            text-shadow: 0 0 10px rgba(46, 204, 113, 0.5);
        }

        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø¬Ø³ÙŠÙ…Ø§Øª */
        .particle-system {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 500;
        }

        /* Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª */
        .notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(145deg, rgba(0, 0, 0, 0.95), rgba(30, 55, 153, 0.95));
            backdrop-filter: blur(25px);
            color: white;
            padding: 30px 50px;
            border-radius: 25px;
            border: 4px solid;
            border-image: linear-gradient(45deg, #3498db, #2ecc71) 1;
            font-size: 28px;
            font-weight: bold;
            text-align: center;
            z-index: 10000;
            opacity: 0;
            pointer-events: none;
            box-shadow: 
                0 30px 80px rgba(0, 0, 0, 0.8),
                0 0 0 2px rgba(255, 255, 255, 0.1);
            min-width: 400px;
        }

        /* ØªØµÙ…ÙŠÙ… Ù…ØªØ¬Ø§ÙˆØ¨ */
        @media (max-width: 1024px) {
            .hud-card {
                padding: 20px 25px;
                min-width: 160px;
            }
            
            .hud-value {
                font-size: 36px;
            }
            
            #joystickArea {
                width: 220px;
                height: 220px;
                bottom: 40px;
                left: 40px;
            }
            
            .joystick-inner {
                width: 90px;
                height: 90px;
            }
            
            .action-btn {
                width: 110px;
                height: 110px;
                font-size: 45px;
            }
            
            .notification {
                padding: 20px 30px;
                font-size: 22px;
                min-width: 300px;
            }
        }

        @media (max-width: 768px) {
            #hud {
                flex-direction: column;
                align-items: center;
                gap: 15px;
                top: 15px;
            }
            
            .hud-card {
                width: 90%;
                min-width: unset;
                padding: 15px 20px;
            }
            
            .hud-value {
                font-size: 32px;
            }
            
            #joystickArea {
                width: 180px;
                height: 180px;
                bottom: 30px;
                left: 30px;
            }
            
            .joystick-inner {
                width: 70px;
                height: 70px;
            }
            
            #actionPanel {
                bottom: 40px;
                right: 40px;
                gap: 25px;
            }
            
            .action-btn {
                width: 90px;
                height: 90px;
                font-size: 35px;
            }
            
            #comboDisplay {
                top: 120px;
                right: 20px;
                padding: 15px 25px;
                font-size: 24px;
            }
        }

        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„ÙˆØ§Ù…Ø¶ */
        .flash-effect {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 800;
            opacity: 0;
        }

        /* Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ù‡Ø§Ù… */
        #missionPanel {
            position: absolute;
            top: 180px;
            left: 30px;
            background: linear-gradient(145deg, rgba(0, 0, 0, 0.9), rgba(30, 40, 80, 0.95));
            padding: 25px;
            border-radius: 20px;
            border: 3px solid #9b59b6;
            min-width: 300px;
            backdrop-filter: blur(15px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.6);
            display: none;
        }

        .mission-title {
            color: #9b59b6;
            font-size: 20px;
            margin-bottom: 15px;
            text-align: center;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(155, 89, 182, 0.5);
        }

        .mission-progress {
            height: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            overflow: hidden;
            margin: 10px 0;
        }

        .mission-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #9b59b6, #8e44ad);
            width: 0%;
            transition: width 0.5s;
        }

        /* Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„ØªØ£Ø«ÙŠØ± */
        .indicator {
            position: absolute;
            width: 100px;
            height: 100px;
            pointer-events: none;
            z-index: 600;
            opacity: 0;
        }
    </style>
</head>
<body>
    <!-- Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ø§Ø±Ù‚Ø© -->
    <div id="loadingScreen">
        <div class="loader-container">
            <div class="loader-ring"></div>
            <div class="loader-ring"></div>
            <div class="loader-ring"></div>
            <div class="loader-ring"></div>
            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
                <i class="fas fa-crown" style="font-size: 60px; color: #f1c40f;"></i>
            </div>
        </div>
        <h1 style="
            font-size: 48px; 
            margin-bottom: 30px; 
            background: linear-gradient(90deg, #3498db, #2ecc71, #e74c3c, #9b59b6, #f1c40f);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            animation: titleGlow 3s infinite alternate;
        ">
            ğŸ‘‘ Ø§Ù„ÙˆÙ„Ø¯ Ø§Ù„Ù…Ù„ÙƒÙŠ - Ø¬Ø±Ø§ÙÙŠÙƒØ³ Ø®Ø§Ø±Ù‚ 10X
        </h1>
        <div id="loadingDetails">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø±Ùƒ Ø§Ù„Ø®Ø§Ø±Ù‚...</div>
        <div class="progress-container">
            <div class="progress-bar" id="progressBar"></div>
        </div>
        <div id="loadingTips" style="margin-top: 40px; font-size: 18px; opacity: 0.8; text-align: center; max-width: 800px; line-height: 1.6;">
            <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 30px;">
                <div><i class="fas fa-gamepad" style="color: #3498db;"></i> ØªØ­ÙƒÙ… ÙƒØ§Ù…Ù„ Ø¨Ù…Ø­Ø§ÙƒØ§Ø© ÙˆØ§Ù‚Ø¹ÙŠØ©</div>
                <div><i class="fas fa-bolt" style="color: #f1c40f;"></i> ØªØ£Ø«ÙŠØ±Ø§Øª Ø¨ØµØ±ÙŠØ© Ø®Ø§Ø±Ù‚Ø©</div>
                <div><i class="fas fa-magic" style="color: #9b59b6;"></i> Ø¬Ø±Ø§ÙÙŠÙƒØ³ Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ ÙØ§Ø¦Ù‚</div>
                <div><i class="fas fa-trophy" style="color: #2ecc71;"></i> Ù†Ø¸Ø§Ù… ØªÙ‚Ø¯Ù… ÙˆÙ…Ù‡Ø§Ù… Ù…ØªÙƒØ§Ù…Ù„</div>
            </div>
        </div>
    </div>
    
    <!-- Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø© -->
    <div id="gameContainer"></div>
    
    <!-- Ø·Ø¨Ù‚Ø© Ø§Ù„ØªØ£Ø«ÙŠØ±Ø§Øª -->
    <div id="effectOverlay"></div>
    
    <!-- Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø¬Ø³ÙŠÙ…Ø§Øª -->
    <div id="particleSystems"></div>
    <div id="flashEffects"></div>
    <div id="indicators"></div>
    
    <!-- ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… -->
    <div id="ui">
        <!-- HUD -->
        <div id="hud">
            <div class="hud-card">
                <div class="hud-title"><i class="fas fa-trophy"></i> Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ù„ÙƒÙŠØ©</div>
                <div class="hud-value" id="score">0</div>
            </div>
            <div class="hud-card">
                <div class="hud-title"><i class="fas fa-heart"></i> Ø·Ø§Ù‚Ø© Ø§Ù„Ø¹Ø±Ø´</div>
                <div class="hud-value" id="health">100%</div>
            </div>
            <div class="hud-card">
                <div class="hud-title"><i class="fas fa-bolt"></i> Ù‚ÙˆØ© Ø§Ù„ØªØ§Ø¬</div>
                <div class="hud-value" id="energy">100%</div>
            </div>
            <div class="hud-card">
                <div class="hud-title"><i class="fas fa-star"></i> Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø¬Ø¯</div>
                <div class="hud-value" id="level">1</div>
            </div>
        </div>
        
        <!-- Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙˆÙ…Ø¨Ùˆ -->
        <div id="comboDisplay">
            <span id="comboCount">0</span> X COMBO!
        </div>
        
        <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ù‡Ø§Ù… -->
        <div id="missionPanel">
            <div class="mission-title"><i class="fas fa-quest"></i> Ø§Ù„Ù…Ù‡Ù…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</div>
            <div id="missionText">Ù‡Ø²Ù… 5 ÙˆØ­ÙˆØ´</div>
            <div class="mission-progress">
                <div class="mission-progress-bar" id="missionProgress"></div>
            </div>
            <div id="missionReward">Ù…ÙƒØ§ÙØ£Ø©: <span id="rewardAmount">1000</span> Ù†Ù‚Ø·Ø©</div>
        </div>
        
        <!-- Ø§Ù„Ø¬ÙˆÙŠØ³ØªÙŠÙƒ -->
        <div id="joystickArea">
            <div class="joystick-outer"></div>
            <div class="joystick-inner" id="joystickHandle"></div>
        </div>
        
        <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… -->
        <div id="actionPanel">
            <div class="action-btn" id="jumpBtn">
                <i class="fas fa-rocket"></i>
                <div class="btn-label" style="
                    position: absolute;
                    bottom: -25px;
                    font-size: 16px;
                    color: #2ecc71;
                    font-weight: bold;
                    white-space: nowrap;
                ">Ù‚ÙØ²Ø© Ù…Ù„ÙƒÙŠØ©</div>
            </div>
            <div class="action-btn" id="attackBtn">
                <i class="fas fa-crosshairs"></i>
                <div class="btn-label" style="
                    position: absolute;
                    bottom: -25px;
                    font-size: 16px;
                    color: #e74c3c;
                    font-weight: bold;
                    white-space: nowrap;
                ">Ù‡Ø¬ÙˆÙ… Ø§Ù„ØªØ§Ø¬</div>
            </div>
            <div class="action-btn" id="specialBtn">
                <i class="fas fa-magic"></i>
                <div class="btn-label" style="
                    position: absolute;
                    bottom: -25px;
                    font-size: 16px;
                    color: #9b59b6;
                    font-weight: bold;
                    white-space: nowrap;
                ">Ù‚ÙˆØ© Ø§Ù„Ø¹Ø±Ø´</div>
            </div>
            <div class="action-btn" id="danceBtn">
                <i class="fas fa-crown"></i>
                <div class="btn-label" style="
                    position: absolute;
                    bottom: -25px;
                    font-size: 16px;
                    color: #f1c40f;
                    font-weight: bold;
                    white-space: nowrap;
                ">Ø±Ù‚ØµØ© Ø§Ù„Ù…Ù„Ùƒ</div>
            </div>
        </div>
        
        <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØµØ­ÙŠØ­ -->
        <div id="debugInfo">
            <div><i class="fas fa-microchip"></i> FPS: <span id="fpsCounter">60</span></div>
            <div><i class="fas fa-shapes"></i> Ø§Ù„Ù…Ø«Ù„Ø«Ø§Øª: <span id="triangleCounter">0</span></div>
            <div><i class="fas fa-memory"></i> Ø§Ù„Ø°Ø§ÙƒØ±Ø©: <span id="memoryCounter">0MB</span></div>
            <div><i class="fas fa-draw-polygon"></i> Ø§Ù„Ø±Ø³ÙˆÙ…Ø§Øª: <span id="drawCallCounter">0</span></div>
        </div>
        
        <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ù‚ÙˆØ© -->
        <div id="powerBar" style="
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            width: 300px;
            height: 20px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            border: 2px solid #3498db;
            overflow: hidden;
            display: none;
        ">
            <div id="powerFill" style="
                height: 100%;
                width: 0%;
                background: linear-gradient(90deg, #3498db, #2ecc71, #f1c40f);
                transition: width 0.3s;
            "></div>
        </div>
    </div>

    <!-- Ù…ÙƒØªØ¨Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© -->
    <script src="https://cdn.jsdelivr.net/npm/howler@2.2.3/dist/howler.min.js"></script>
    
    <!-- Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ø§Ù„Ø®Ø§Ø±Ù‚ -->
    <script>
        // ======= Ù†Ø¸Ø§Ù… Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ø®Ø§Ø±Ù‚ =======
        console.log('%cğŸ‘‘ Ø§Ù„ÙˆÙ„Ø¯ Ø§Ù„Ù…Ù„ÙƒÙŠ - Ù…Ø­Ø±Ùƒ Ø®Ø§Ø±Ù‚ 10X', 'font-size: 24px; color: #f1c40f; font-weight: bold; text-shadow: 0 0 10px #f1c40f');
        console.time('UltraGraphicsEngine');
        
        // Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙƒÙˆÙŠÙ†
        const ULTRA_CONFIG = {
            GRAPHICS_QUALITY: 'ULTRA',
            PHYSICS_DETAIL: 10,
            PARTICLE_COUNT: 5000,
            SHADOW_QUALITY: 4096,
            TEXTURE_DETAIL: 2048,
            LOD_DISTANCE: 1000,
            MAX_EFFECTS: 100,
            RENDER_DISTANCE: 2000
        };
        
        // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
        let scene, camera, renderer, composer, clock, stats;
        let player, world, physicsWorld;
        let moveVector = { x: 0, y: 0 };
        let isJumping = false, isDancing = false, isAttacking = false, isSpecialActive = false;
        let score = 0, health = 100, energy = 100, level = 1, experience = 0, combo = 0, comboTimeout;
        let particles = [], effects = [], enemies = [], collectibles = [];
        let lastTime = 0, frameCount = 0, fps = 60;
        let touchId = null, isDragging = false;
        let currentMission = 0, missionProgress = 0;
        
        // Ù…Ù‡Ù…Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©
        const MISSIONS = [
            { id: 1, name: "Ù‡Ø²Ù… 5 Ø­Ø±Ø§Ø³ Ø§Ù„Ø¸Ù„", target: 5, current: 0, reward: 5000, type: 'enemy' },
            { id: 2, name: "Ø§Ø¬Ù…Ø¹ 3 ØªÙŠØ¬Ø§Ù† Ø§Ù„Ø·Ø§Ù‚Ø©", target: 3, current: 0, reward: 8000, type: 'collectible' },
            { id: 3, name: "Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ 15 ÙƒÙˆÙ…Ø¨Ùˆ Ù…Ù„ÙƒÙŠ", target: 15, current: 0, reward: 12000, type: 'combo' },
            { id: 4, name: "Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù‚ÙˆØ© Ø§Ù„Ù…Ù„ÙƒÙŠØ© 8 Ù…Ø±Ø§Øª", target: 8, current: 0, reward: 15000, type: 'special' },
            { id: 5, name: "Ø§ÙƒÙ…Ù„ 10 Ù‚ÙØ²Ø§Øª Ù…Ù„ÙƒÙŠØ©", target: 10, current: 0, reward: 10000, type: 'jump' }
        ];
        
        // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡
        const performanceStats = {
            triangles: 0,
            vertices: 0,
            drawCalls: 0,
            fps: 60,
            memory: 0,
            particles: 0,
            objects: 0
        };
        
        // ØªØ­Ø¯ÙŠØ« Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
        function updateLoading(text, progress) {
            const details = document.getElementById('loadingDetails');
            const bar = document.getElementById('progressBar');
            if (details) details.textContent = text;
            if (bar) bar.style.width = `${progress}%`;
            
            // Ù†ØµØ§Ø¦Ø­ ØªØ­Ù…ÙŠÙ„ Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
            const tips = [
                "ğŸš€ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø±Ùƒ Ø§Ù„Ø®Ø§Ø±Ù‚ Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯...",
                "âœ¨ ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… Ø§Ù„Ø¬Ø³ÙŠÙ…Ø§Øª Ø§Ù„ÙØ§Ø¦Ù‚...",
                "ğŸ‘‘ Ø¥Ù†Ø´Ø§Ø¡ Ø´Ø®ØµÙŠØ© Ø§Ù„ÙˆÙ„Ø¯ Ø§Ù„Ù…Ù„ÙƒÙŠ Ø¨ØªÙØ§ØµÙŠÙ„ Ù…Ø°Ù‡Ù„Ø©...",
                "ğŸŒ Ø¨Ù†Ø§Ø¡ Ø¹Ø§Ù„Ù… Ù…ÙØªÙˆØ­ Ø¨ØªÙ‚Ù†ÙŠØ§Øª Ø®Ø§Ø±Ù‚Ø©...",
                "âš¡ ØªØ­Ù…ÙŠÙ„ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¶Ø§Ø¡Ø© ÙˆØ§Ù„Ø¸Ù„Ø§Ù„ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…...",
                "ğŸ® ØªÙ‡ÙŠØ¦Ø© ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…Ù„ÙƒÙŠØ©...",
                "ğŸ”¥ ØªØ­Ø¶ÙŠØ± Ø§Ù„ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø¨ØµØ±ÙŠØ© Ø§Ù„Ø®Ø§Ø±Ù‚Ø©...",
                "ğŸ’ ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡ Ù„Ù„Ø¬Ø±Ø§ÙÙŠÙƒØ³ ÙØ§Ø¦Ù‚ Ø§Ù„Ø¬ÙˆØ¯Ø©..."
            ];
            
            if (progress % 15 === 0 && details) {
                details.textContent = tips[Math.floor(Math.random() * tips.length)];
            }
        }
        
        // ØªØ­Ù…ÙŠÙ„ Three.js
        updateLoading("ğŸš€ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù…Ø­Ø±Ùƒ Ø§Ù„Ø¬Ø±Ø§ÙÙŠÙƒØ³ Ø§Ù„Ø®Ø§Ø±Ù‚...", 10);
        
        // ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©
        function loadLibrary(url, callback) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = url;
                script.onload = () => {
                    console.log(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„: ${url}`);
                    if (callback) callback();
                    resolve();
                };
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }
        
        // ØªØ­Ù…ÙŠÙ„ ÙƒÙ„ Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª
        Promise.all([
            loadLibrary('https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js'),
            loadLibrary('https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/EffectComposer.js'),
            loadLibrary('https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/RenderPass.js'),
            loadLibrary('https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/ShaderPass.js'),
            loadLibrary('https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/UnrealBloomPass.js'),
            loadLibrary('https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/shaders/CopyShader.js')
        ]).then(() => {
            console.log("âœ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª ØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡Ø§ Ø¨Ù†Ø¬Ø§Ø­!");
            updateLoading("âœ¨ ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… Ø§Ù„Ø¬Ø±Ø§ÙÙŠÙƒØ³ Ø§Ù„Ø®Ø§Ø±Ù‚...", 30);
            initializeUltraGraphicsEngine();
        }).catch(error => {
            console.error("âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª:", error);
            updateLoading("âš ï¸ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©...", 30);
            loadLibrary('https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js', initializeUltraGraphicsEngine);
        });
        
        // Ù…Ø­Ø±Ùƒ Ø§Ù„Ø¬Ø±Ø§ÙÙŠÙƒØ³ Ø§Ù„Ø®Ø§Ø±Ù‚
        function initializeUltraGraphicsEngine() {
            try {
                updateLoading("ğŸŒŒ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø´Ù‡Ø¯ Ø§Ù„ÙƒÙˆÙ†ÙŠ...", 40);
                
                // 1. Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø´Ù‡Ø¯ Ø®Ø§Ø±Ù‚ Ø§Ù„Ø¬ÙˆØ¯Ø©
                scene = new THREE.Scene();
                scene.fog = new THREE.FogExp2(0x87CEEB, 0.001);
                
                // 2. Ø¥Ù†Ø´Ø§Ø¡ ÙƒØ§Ù…ÙŠØ±Ø§ Ø®Ø§Ø±Ù‚Ø©
                camera = new THREE.PerspectiveCamera(
                    85,
                    window.innerWidth / window.innerHeight,
                    0.1,
                    ULTRA_CONFIG.RENDER_DISTANCE
                );
                camera.position.set(0, 8, 15);
                camera.lookAt(0, 0, 0);
                
                updateLoading("ğŸ¨ Ø¥Ù†Ø´Ø§Ø¡ Ù…ÙØ¹Ø±Ø¶ Ø§Ù„Ø¬Ø±Ø§ÙÙŠÙƒØ³ Ø§Ù„Ø®Ø§Ø±Ù‚...", 50);
                
                // 3. Ø¥Ù†Ø´Ø§Ø¡ Ù…ÙØ¹Ø±Ø¶ WebGL Ø®Ø§Ø±Ù‚
                const canvas = document.createElement('canvas');
                const context = canvas.getContext('webgl2', { 
                    alpha: true,
                    antialias: true,
                    depth: true,
                    stencil: true,
                    powerPreference: "high-performance",
                    preserveDrawingBuffer: false,
                    premultipliedAlpha: false
                });
                
                renderer = new THREE.WebGLRenderer({ 
                    canvas: canvas,
                    context: context,
                    antialias: true,
                    alpha: true,
                    powerPreference: "high-performance",
                    precision: "highp",
                    stencil: true,
                    depth: true,
                    logarithmicDepthBuffer: true
                });
                
                renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.shadowMap.enabled = true;
                renderer.shadowMap.type = THREE.PCFSoftShadowMap;
                renderer.shadowMap.autoUpdate = true;
                renderer.outputEncoding = THREE.sRGBEncoding;
                renderer.toneMapping = THREE.ACESFilmicToneMapping;
                renderer.toneMappingExposure = 1.3;
                renderer.physicallyCorrectLights = true;
                renderer.gammaFactor = 2.2;
                renderer.gammaOutput = true;
                
                // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙØ¹Ø±Ø¶ Ø¥Ù„Ù‰ Ø§Ù„ØµÙØ­Ø©
                document.getElementById('gameContainer').appendChild(renderer.domElement);
                
                updateLoading("ğŸ’¡ Ø¥Ø¹Ø¯Ø§Ø¯ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¶Ø§Ø¡Ø© Ø§Ù„Ø®Ø§Ø±Ù‚...", 60);
                
                // 4. Ø¥Ø¹Ø¯Ø§Ø¯ Ø¥Ø¶Ø§Ø¡Ø© Ø®Ø§Ø±Ù‚Ø© Ø§Ù„Ø¬ÙˆØ¯Ø©
                setupUltraLightingSystem();
                
                updateLoading("ğŸ‘‘ Ø¥Ù†Ø´Ø§Ø¡ Ø´Ø®ØµÙŠØ© Ø§Ù„ÙˆÙ„Ø¯ Ø§Ù„Ù…Ù„ÙƒÙŠ Ø§Ù„Ø®Ø§Ø±Ù‚Ø©...", 70);
                
                // 5. Ø¥Ù†Ø´Ø§Ø¡ Ø´Ø®ØµÙŠØ© Ø®Ø§Ø±Ù‚Ø© Ø§Ù„Ø¬ÙˆØ¯Ø©
                createUltraKingPlayer();
                
                updateLoading("ğŸŒ Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø¹Ø§Ù„Ù… Ø§Ù„Ø®ÙŠØ§Ù„ÙŠ Ø§Ù„Ø®Ø§Ø±Ù‚...", 80);
                
                // 6. Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ø§Ù„Ù… Ø®Ø§Ø±Ù‚ Ø§Ù„Ø¬ÙˆØ¯Ø©
                createUltraFantasyWorld();
                
                updateLoading("âš¡ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø¨ØµØ±ÙŠØ© Ø§Ù„Ø®Ø§Ø±Ù‚Ø©...", 85);
                
                // 7. Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø¤Ø«Ø±Ø§Øª Ù…Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©
                setupPostProcessing();
                
                updateLoading("ğŸ® Ø¥Ø¹Ø¯Ø§Ø¯ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…Ù„ÙƒÙŠØ©...", 90);
                
                // 8. Ø¥Ø¹Ø¯Ø§Ø¯ Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø®Ø§Ø±Ù‚
                setupUltraControlSystem();
                
                // 9. Ù…Ø¹Ø§Ù„Ø¬Ø© ØªØºÙŠÙŠØ± Ø­Ø¬Ù… Ø§Ù„Ù†Ø§ÙØ°Ø©
                window.addEventListener('resize', onWindowResize);
                
                // 10. Ø¨Ø¯Ø¡ Ø§Ù„Ø³Ø§Ø¹Ø©
                clock = new THREE.Clock();
                
                updateLoading("ğŸš€ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¥Ù‚Ù„Ø§Ø¹ Ø§Ù„Ù…Ù„ÙƒÙŠ...", 95);
                
                // 11. Ø¨Ø¯Ø¡ Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
                setTimeout(() => {
                    document.getElementById('loadingScreen').style.display = 'none';
                    document.getElementById('missionPanel').style.display = 'block';
                    document.getElementById('powerBar').style.display = 'block';
                    
                    // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨ÙŠØ©
                    showNotification('ğŸ‘‘ Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¬Ø±Ø§ÙÙŠÙƒØ³ Ø§Ù„Ø®Ø§Ø±Ù‚!', '#f1c40f');
                    
                    // Ø¨Ø¯Ø¡ Ø§Ù„Ø­Ù„Ù‚Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                    animate();
                    
                    // Ø¨Ø¯Ø¡ Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
                    startGameSystems();
                    
                    console.timeEnd('UltraGraphicsEngine');
                    console.log("ğŸ® Ù…Ø­Ø±Ùƒ Ø§Ù„Ø¬Ø±Ø§ÙÙŠÙƒØ³ Ø§Ù„Ø®Ø§Ø±Ù‚ ÙŠØ¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­!");
                    console.log("âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª:", ULTRA_CONFIG);
                    
                    // Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØµØ­ÙŠØ­
                    updateDebugInfo();
                    setInterval(updateDebugInfo, 1000);
                    
                }, 2000);
                
            } catch (error) {
                console.error("âŒ Ø®Ø·Ø£ ÙØ§Ø¯Ø­ ÙÙŠ Ø§Ù„Ù…Ø­Ø±Ùƒ:", error);
                updateLoading(`ğŸ’¥ Ø®Ø·Ø£ Ø­Ø±Ø¬: ${error.message}`, 0);
                showErrorScreen(error);
            }
        }
        
        // Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¶Ø§Ø¡Ø© Ø§Ù„Ø®Ø§Ø±Ù‚
        function setupUltraLightingSystem() {
            // Ø¶ÙˆØ¡ Ø§Ù„Ø´Ù…Ø³ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
            const sunLight = new THREE.DirectionalLight(0xffffff, 2.5);
            sunLight.position.set(100, 200, 100);
            sunLight.castShadow = true;
            sunLight.shadow.mapSize.width = ULTRA_CONFIG.SHADOW_QUALITY;
            sunLight.shadow.mapSize.height = ULTRA_CONFIG.SHADOW_QUALITY;
            sunLight.shadow.camera.near = 1;
            sunLight.shadow.camera.far = 500;
            sunLight.shadow.camera.left = -150;
            sunLight.shadow.camera.right = 150;
            sunLight.shadow.camera.top = 150;
            sunLight.shadow.camera.bottom = -150;
            sunLight.shadow.bias = -0.0005;
            sunLight.shadow.radius = 4;
            scene.add(sunLight);
            
            // Ù…Ø³Ø§Ø¹Ø¯ Ø¶ÙˆØ¡ Ø§Ù„Ø´Ù…Ø³
            const sunHelper = new THREE.DirectionalLightHelper(sunLight, 5);
            scene.add(sunHelper);
            
            // Ø¥Ø¶Ø§Ø¡Ø© Ù…Ù„Ø¦ Ù†Ø§Ø¹Ù…Ø©
            const ambientLight = new THREE.AmbientLight(0x404040, 0.8);
            scene.add(ambientLight);
            
            // Ø£Ø¶ÙˆØ§Ø¡ Ù†Ù‚Ø·ÙŠØ© Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ©
            const pointLightColors = [
                0x3498db, 0x2ecc71, 0xe74c3c, 0x9b59b6, 0xf1c40f,
                0x1abc9c, 0xd35400, 0xc0392b, 0x8e44ad, 0x16a085
            ];
            
            for (let i = 0; i < 15; i++) {
                const color = pointLightColors[Math.floor(Math.random() * pointLightColors.length)];
                const light = new THREE.PointLight(color, 1.2, 150, 2);
                
                const angle = Math.random() * Math.PI * 2;
                const radius = 50 + Math.random() * 100;
                const height = 20 + Math.random() * 40;
                
                light.position.set(
                    Math.cos(angle) * radius,
                    height,
                    Math.sin(angle) * radius
                );
                
                light.decay = 2;
                light.castShadow = true;
                scene.add(light);
                
                // Ø¥Ø¶Ø§ÙØ© Ù…Ø³Ø§Ø¹Ø¯ Ù„Ù„Ø¶ÙˆØ¡
                const helper = new THREE.PointLightHelper(light, 2);
                scene.add(helper);
                
                // Ø¬Ø¹Ù„ Ø§Ù„Ø£Ø¶ÙˆØ§Ø¡ ØªØªØ­Ø±Ùƒ
                light.userData = {
                    speed: 0.5 + Math.random() * 1,
                    radius: radius,
                    angle: angle,
                    height: height
                };
            }
            
            // Ø¥Ø¶Ø§Ø¡Ø© Ø¨ÙŠØ¦ÙŠØ© Ù„Ù„Ø³Ù…Ø§Ø¡
            const hemiLight = new THREE.HemisphereLight(0x87CEEB, 0x90EE90, 0.5);
            scene.add(hemiLight);
            
            // Ø£Ø¶ÙˆØ§Ø¡ Ù…Ø³Ø±Ø­ÙŠØ©
            const spotLight = new THREE.SpotLight(0xffffff, 1.5, 200, Math.PI / 6, 0.5, 2);
            spotLight.position.set(0, 50, 0);
            spotLight.castShadow = true;
            scene.add(spotLight);
            
            // Ø¥Ø¶Ø§ÙØ© Ø¶ÙˆØ¡ Ù…ØªØªØ¨Ø¹ Ù„Ù„Ø§Ø¹Ø¨
            const followLight = new THREE.PointLight(0x3498db, 0.8, 50);
            followLight.position.set(0, 10, 0);
            scene.add(followLight);
        }
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø´Ø®ØµÙŠØ© Ø§Ù„ÙˆÙ„Ø¯ Ø§Ù„Ù…Ù„ÙƒÙŠ Ø§Ù„Ø®Ø§Ø±Ù‚Ø©
        function createUltraKingPlayer() {
            player = new THREE.Group();
            player.name = "UltraKingPlayer";
            player.userData = {
                speed: 0.15,
                jumpForce: 0.3,
                rotationSpeed: 0.1,
                scale: 1.5
            };
            
            // ===== Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø¬Ø³Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ =====
            // Ø§Ù„ØµØ¯Ø±
            const chestGeometry = new THREE.CylinderGeometry(0.6, 0.7, 1.2, 32);
            const chestMaterial = new THREE.MeshStandardMaterial({
                color: 0x2c3e50,
                metalness: 0.8,
                roughness: 0.2,
                emissive: 0x1a252f,
                emissiveIntensity: 0.3
            });
            const chest = new THREE.Mesh(chestGeometry, chestMaterial);
            chest.position.y = 1.2;
            chest.castShadow = true;
            chest.receiveShadow = true;
            player.add(chest);
            
            // Ø§Ù„Ø¨Ø·Ù†
            const abdomenGeometry = new THREE.CylinderGeometry(0.7, 0.6, 0.8, 32);
            const abdomen = new THREE.Mesh(abdomenGeometry, chestMaterial);
            abdomen.position.y = 0.4;
            abdomen.castShadow = true;
            player.add(abdomen);
            
            // ===== Ø§Ù„Ø±Ø£Ø³ Ø§Ù„Ø®Ø§Ø±Ù‚ =====
            const headGroup = new THREE.Group();
            
            // Ø§Ù„Ø¬Ù…Ø¬Ù…Ø©
            const skullGeometry = new THREE.SphereGeometry(0.55, 64, 64);
            const skullMaterial = new THREE.MeshStandardMaterial({
                color: 0xFFE0BD,
                roughness: 0.1,
                metalness: 0.3,
                normalScale: new THREE.Vector2(0.8, 0.8)
            });
            const skull = new THREE.Mesh(skullGeometry, skullMaterial);
            skull.position.y = 2.4;
            skull.castShadow = true;
            headGroup.add(skull);
            
            // Ø§Ù„Ø¹ÙŠÙˆÙ† - ØªØ£Ø«ÙŠØ± Ù„ÙŠØ²Ø±
            const eyeGeometry = new THREE.SphereGeometry(0.12, 32, 32);
            const eyeMaterial = new THREE.MeshStandardMaterial({
                color: 0x00FF00,
                emissive: 0x00FF00,
                emissiveIntensity: 1.5,
                roughness: 0.1,
                metalness: 0.9,
                transparent: true,
                opacity: 0.95
            });
            
            const leftEye = new THREE.Mesh(eyeGeometry, eyeMaterial);
            leftEye.position.set(-0.22, 2.45, 0.48);
            leftEye.name = "leftEye";
            headGroup.add(leftEye);
            
            const rightEye = new THREE.Mesh(eyeGeometry, eyeMaterial);
            rightEye.position.set(0.22, 2.45, 0.48);
            rightEye.name = "rightEye";
            headGroup.add(rightEye);
            
            // Ø­ÙˆØ§Ø¬Ø¨ Ù…Ø¹Ø¯Ù†ÙŠØ©
            const eyebrowGeometry = new THREE.BoxGeometry(0.4, 0.08, 0.08);
            const eyebrowMaterial = new THREE.MeshStandardMaterial({
                color: 0x333333,
                metalness: 1,
                roughness: 0.1
            });
            
            const leftEyebrow = new THREE.Mesh(eyebrowGeometry, eyebrowMaterial);
            leftEyebrow.position.set(-0.22, 2.65, 0.42);
            leftEyebrow.rotation.z = 0.2;
            headGroup.add(leftEyebrow);
            
            const rightEyebrow = new THREE.Mesh(eyebrowGeometry, eyebrowMaterial);
            rightEyebrow.position.set(0.22, 2.65, 0.42);
            rightEyebrow.rotation.z = -0.2;
            headGroup.add(rightEyebrow);
            
            // Ø§Ù„ÙÙ… - Ø®Ø· Ù„ÙŠØ²Ø±
            const mouthGeometry = new THREE.TorusGeometry(0.25, 0.03, 16, 32, Math.PI);
            const mouthMaterial = new THREE.MeshBasicMaterial({
                color: 0xFF0000,
                emissive: 0xFF0000,
                emissiveIntensity: 2
            });
            const mouth = new THREE.Mesh(mouthGeometry, mouthMaterial);
            mouth.position.set(0, 2.15, 0.5);
            mouth.rotation.x = Math.PI;
            headGroup.add(mouth);
            
            // ===== Ø§Ù„ØªØ§Ø¬ Ø§Ù„Ù…Ù„ÙƒÙŠ Ø§Ù„Ø®Ø§Ø±Ù‚ =====
            const crownGroup = new THREE.Group();
            
            // Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„ØªØ§Ø¬ - Ø°Ù‡Ø¨ Ù…ØªÙˆÙ‡Ø¬
            const crownBaseGeometry = new THREE.TorusGeometry(0.65, 0.08, 16, 32);
            const crownBaseMaterial = new THREE.MeshStandardMaterial({
                color: 0xFFD700,
                metalness: 1,
                roughness: 0.05,
                emissive: 0xFFD700,
                emissiveIntensity: 0.8
            });
            const crownBase = new THREE.Mesh(crownBaseGeometry, crownBaseMaterial);
            crownBase.rotation.x = Math.PI / 2;
            crownGroup.add(crownBase);
            
            // Ø£Ø´ÙˆØ§Ùƒ Ø§Ù„ØªØ§Ø¬ - Ù…Ø§Ø³Ø§Øª
            for (let i = 0; i < 12; i++) {
                const spikeGeometry = new THREE.ConeGeometry(0.07, 0.4, 8);
                const spikeMaterial = new THREE.MeshStandardMaterial({
                    color: 0xFFFFFF,
                    metalness: 1,
                    roughness: 0,
                    emissive: 0xFFFFFF,
                    emissiveIntensity: 1.2,
                    transparent: true,
                    opacity: 0.9
                });
                const spike = new THREE.Mesh(spikeGeometry, spikeMaterial);
                
                const angle = (i / 12) * Math.PI * 2;
                const radius = 0.65;
                
                spike.position.set(
                    Math.cos(angle) * radius,
                    0.2,
                    Math.sin(angle) * radius
                );
                spike.rotation.z = angle;
                spike.rotation.x = Math.PI / 2;
                
                crownGroup.add(spike);
                
                // Ø¬ÙˆÙ‡Ø±Ø© ÙÙŠ Ù‚Ù…Ø© ÙƒÙ„ Ø´ÙˆÙƒØ©
                const gemGeometry = new THREE.OctahedronGeometry(0.05, 0);
                const gemColors = [0xFF0000, 0x00FF00, 0x0000FF, 0xFFFF00, 0xFF00FF];
                const gemMaterial = new THREE.MeshStandardMaterial({
                    color: gemColors[i % gemColors.length],
                    metalness: 0.9,
                    roughness: 0.1,
                    emissive: gemColors[i % gemColors.length],
                    emissiveIntensity: 1
                });
                const gem = new THREE.Mesh(gemGeometry, gemMaterial);
                gem.position.y = 0.2;
                spike.add(gem);
            }
            
            crownGroup.position.y = 2.95;
            headGroup.add(crownGroup);
            
            // ===== Ø§Ù„Ø´Ø¹Ø± Ø§Ù„Ø®Ø§Ø±Ù‚ =====
            const hairGroup = new THREE.Group();
            const hairMaterial = new THREE.MeshStandardMaterial({
                color: 0x8B4513,
                metalness: 0.5,
                roughness: 0.7
            });
            
            // Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø´Ø¹Ø±
            const baseHairGeometry = new THREE.SphereGeometry(0.58, 32, 32, 0, Math.PI * 2, 0, Math.PI / 2);
            const baseHair = new THREE.Mesh(baseHairGeometry, hairMaterial);
            baseHair.position.y = 0.15;
            hairGroup.add(baseHair);
            
            // Ø®ØµÙ„Ø§Øª Ø´Ø¹Ø± Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ©
            for (let i = 0; i < 20; i++) {
                const strandGeometry = new THREE.CylinderGeometry(0.025, 0.015, 0.4, 8);
                const strand = new THREE.Mesh(strandGeometry, hairMaterial);
                
                const angle = (i / 20) * Math.PI * 2;
                const radius = 0.55;
                
                strand.position.set(
                    Math.cos(angle) * radius,
                    0.3,
                    Math.sin(angle) * radius
                );
                strand.rotation.x = Math.PI / 2 + Math.sin(angle) * 0.5;
                strand.rotation.z = angle;
                
                strand.userData = {
                    originalY: strand.position.y,
                    waveSpeed: 2 + Math.random() * 3,
                    waveAmplitude: 0.1 + Math.random() * 0.2
                };
                
                hairGroup.add(strand);
            }
            
            hairGroup.position.y = 2.7;
            headGroup.add(hairGroup);
            
            player.add(headGroup);
            
            // ===== Ø§Ù„Ø£Ø°Ø±Ø¹ Ø§Ù„Ø®Ø§Ø±Ù‚Ø© =====
            createUltraArm('left', -0.8, 1.5);
            createUltraArm('right', 0.8, 1.5);
            
            // ===== Ø§Ù„Ø£Ø±Ø¬Ù„ Ø§Ù„Ø®Ø§Ø±Ù‚Ø© =====
            createUltraLeg('left', -0.35, 0);
            createUltraLeg('right', 0.35, 0);
            
            // ===== Ø§Ù„Ø£Ø¬Ù†Ø­Ø© Ø§Ù„Ù…Ù„ÙƒÙŠØ© =====
            createRoyalWings();
            
            // ===== Ø§Ù„Ù‡Ø§Ù„Ø© Ø§Ù„Ù…Ù„ÙƒÙŠØ© =====
            createRoyalHalo();
            
            // ===== ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø¬Ø³ÙŠÙ…Ø§Øª Ø§Ù„Ø¯Ø§Ø¦Ù…Ø© =====
            createPlayerParticles();
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù„Ø§Ø¹Ø¨ Ù„Ù„Ù…Ø´Ù‡Ø¯
            player.position.set(0, 3, 0);
            player.scale.setScalar(player.userData.scale);
            player.castShadow = true;
            player.receiveShadow = true;
            scene.add(player);
            
            console.log("ğŸ‘‘ Ø´Ø®ØµÙŠØ© Ø§Ù„ÙˆÙ„Ø¯ Ø§Ù„Ù…Ù„ÙƒÙŠ Ø§Ù„Ø®Ø§Ø±Ù‚Ø© ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡Ø§!");
        }
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø°Ø±Ø§Ø¹ Ø®Ø§Ø±Ù‚
        function createUltraArm(side, x, y) {
            const armGroup = new THREE.Group();
            armGroup.name = `${side}Arm`;
            
            // Ø§Ù„Ø°Ø±Ø§Ø¹ Ø§Ù„Ø¹Ù„ÙˆÙŠ
            const upperArmGeometry = new THREE.CylinderGeometry(0.15, 0.18, 1.2, 16);
            const upperArmMaterial = new THREE.MeshStandardMaterial({
                color: side === 'left' ? 0x3498db : 0xe74c3c,
                metalness: 0.7,
                roughness: 0.3,
                emissive: side === 'left' ? 0x1a5276 : 0x78281f,
                emissiveIntensity: 0.4
            });
            const upperArm = new THREE.Mesh(upperArmGeometry, upperArmMaterial);
            upperArm.rotation.z = Math.PI / 2;
            upperArm.castShadow = true;
            armGroup.add(upperArm);
            
            // Ø§Ù„Ù…Ø±ÙÙ‚ - Ø¬ÙˆÙ‡Ø±Ø© Ø·Ø§Ù‚Ø©
            const elbowGeometry = new THREE.SphereGeometry(0.2, 16, 16);
            const elbowMaterial = new THREE.MeshStandardMaterial({
                color: 0xf1c40f,
                metalness: 0.9,
                roughness: 0.1,
                emissive: 0xf1c40f,
                emissiveIntensity: 0.8
            });
            const elbow = new THREE.Mesh(elbowGeometry, elbowMaterial);
            elbow.position.x = 0.6;
            elbow.castShadow = true;
            armGroup.add(elbow);
            
            // Ø§Ù„Ø°Ø±Ø§Ø¹ Ø§Ù„Ø³ÙÙ„ÙŠ
            const lowerArmGeometry = new THREE.CylinderGeometry(0.12, 0.15, 1, 16);
            const lowerArm = new THREE.Mesh(lowerArmGeometry, upperArmMaterial);
            lowerArm.position.x = 1.1;
            lowerArm.rotation.z = Math.PI / 2;
            lowerArm.castShadow = true;
            armGroup.add(lowerArm);
            
            // Ø§Ù„ÙŠØ¯ - ØªÙ‚Ù†ÙŠØ§Øª Ù…ØªÙ‚Ø¯Ù…Ø©
            const handGroup = new THREE.Group();
            const handGeometry = new THREE.SphereGeometry(0.18, 16, 16);
            const handMaterial = new THREE.MeshStandardMaterial({
                color: 0xFFE0BD,
                metalness: 0.5,
                roughness: 0.4
            });
            const hand = new THREE.Mesh(handGeometry, handMaterial);
            hand.position.x = 1.6;
            hand.castShadow = true;
            handGroup.add(hand);
            
            // Ø§Ù„Ø£ØµØ§Ø¨Ø¹ - Ø£Ø³Ù„Ø­Ø© Ø·Ø§Ù‚Ø©
            for (let i = 0; i < 5; i++) {
                const fingerGeometry = new THREE.CylinderGeometry(0.04, 0.03, 0.25, 8);
                const fingerMaterial = new THREE.MeshStandardMaterial({
                    color: side === 'left' ? 0x3498db : 0xe74c3c,
                    metalness: 0.8,
                    roughness: 0.2,
                    emissive: side === 'left' ? 0x3498db : 0xe74c3c,
                    emissiveIntensity: 0.5
                });
                const finger = new THREE.Mesh(fingerGeometry, fingerMaterial);
                
                const angle = (i - 2) * 0.2;
                finger.position.set(
                    1.6 + 0.15,
                    0,
                    angle
                );
                finger.rotation.z = Math.PI / 2;
                finger.rotation.y = angle * 1.5;
                
                handGroup.add(finger);
                
                // Ø£Ø·Ø±Ø§Ù Ø§Ù„Ø£ØµØ§Ø¨Ø¹ - Ù„ÙŠØ²Ø±
                const tipGeometry = new THREE.SphereGeometry(0.05, 8, 8);
                const tipMaterial = new THREE.MeshBasicMaterial({
                    color: 0x00FF00,
                    emissive: 0x00FF00,
                    emissiveIntensity: 2
                });
                const tip = new THREE.Mesh(tipGeometry, tipMaterial);
                tip.position.x = 0.12;
                finger.add(tip);
            }
            
            armGroup.add(handGroup);
            armGroup.position.set(x, y, 0);
            player.add(armGroup);
            
            return armGroup;
        }
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø¬Ù„ Ø®Ø§Ø±Ù‚Ø©
        function createUltraLeg(side, x, y) {
            const legGroup = new THREE.Group();
            legGroup.name = `${side}Leg`;
            
            // Ø§Ù„ÙØ®Ø°
            const upperLegGeometry = new THREE.CylinderGeometry(0.22, 0.25, 1.2, 16);
            const upperLegMaterial = new THREE.MeshStandardMaterial({
                color: 0x2c3e50,
                metalness: 0.6,
                roughness: 0.4
            });
            const upperLeg = new THREE.Mesh(upperLegGeometry, upperLegMaterial);
            upperLeg.castShadow = true;
            legGroup.add(upperLeg);
            
            // Ø§Ù„Ø±ÙƒØ¨Ø© - Ø¯Ø±Ø¹ Ù…ØªØ­Ø±Ùƒ
            const kneeGeometry = new THREE.SphereGeometry(0.25, 16, 16);
            const kneeMaterial = new THREE.MeshStandardMaterial({
                color: 0x7f8c8d,
                metalness: 0.8,
                roughness: 0.3
            });
            const knee = new THREE.Mesh(kneeGeometry, kneeMaterial);
            knee.position.y = -0.6;
            knee.castShadow = true;
            legGroup.add(knee);
            
            // Ø§Ù„Ø³Ø§Ù‚
            const lowerLegGeometry = new THREE.CylinderGeometry(0.18, 0.2, 1, 16);
            const lowerLeg = new THREE.Mesh(lowerLegGeometry, upperLegMaterial);
            lowerLeg.position.y = -1.1;
            lowerLeg.castShadow = true;
            legGroup.add(lowerLeg);
            
            // Ø§Ù„Ù‚Ø¯Ù… - ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ Ù…ØªØ·ÙˆØ±Ø©
            const footGeometry = new THREE.BoxGeometry(0.35, 0.15, 0.7);
            const footMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x34495e,
                metalness: 0.7,
                roughness: 0.4
            });
            const foot = new THREE.Mesh(footGeometry, footMaterial);
            foot.position.set(0, -1.6, 0.2);
            foot.castShadow = true;
            legGroup.add(foot);
            
            // Ù†Ø¹Ù„ Ø§Ù„Ù‚Ø¯Ù… - ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø·Ø§Ù‚Ø©
            const soleGeometry = new THREE.BoxGeometry(0.4, 0.05, 0.8);
            const soleMaterial = new THREE.MeshBasicMaterial({
                color: side === 'left' ? 0x3498db : 0xe74c3c,
                emissive: side === 'left' ? 0x3498db : 0xe74c3c,
                emissiveIntensity: 0.8
            });
            const sole = new THREE.Mesh(soleGeometry, soleMaterial);
            sole.position.set(0, -1.72, 0.2);
            legGroup.add(sole);
            
            legGroup.position.set(x, y, 0);
            player.add(legGroup);
            
            return legGroup;
        }
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø£Ø¬Ù†Ø­Ø© Ù…Ù„ÙƒÙŠØ©
        function createRoyalWings() {
            const wingsGroup = new THREE.Group();
            wingsGroup.name = "royalWings";
            
            // Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø£Ø¬Ù†Ø­Ø©
            const wingBaseGeometry = new THREE.BoxGeometry(0.3, 0.3, 0.3);
            const wingBaseMaterial = new THREE.MeshStandardMaterial({
                color: 0xf1c40f,
                metalness: 0.9,
                roughness: 0.1
            });
            const wingBase = new THREE.Mesh(wingBaseGeometry, wingBaseMaterial);
            wingBase.position.y = 1.8;
            wingsGroup.add(wingBase);
            
            // Ø§Ù„Ø±ÙŠØ´ - Ø·Ø¨Ù‚Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø©
            const featherColors = [0xf1c40f, 0xf39c12, 0xe67e22, 0xd35400];
            
            for (let layer = 0; layer < 4; layer++) {
                for (let i = 0; i < 8; i++) {
                    const featherGeometry = new THREE.ConeGeometry(
                        0.15 - (layer * 0.03),
                        0.8 - (layer * 0.15),
                        8
                    );
                    const featherMaterial = new THREE.MeshStandardMaterial({
                        color: featherColors[layer],
                        metalness: 0.8,
                        roughness: 0.2,
                        side: THREE.DoubleSide
                    });
                    
                    // Ø§Ù„Ø¬Ù†Ø§Ø­ Ø§Ù„Ø£ÙŠØ³Ø±
                    const leftFeather = new THREE.Mesh(featherGeometry, featherMaterial);
                    leftFeather.position.set(
                        -0.5 - (layer * 0.3),
                        1.8,
                        (i - 3.5) * 0.2
                    );
                    leftFeather.rotation.y = Math.PI / 2;
                    leftFeather.rotation.z = -0.3 - (layer * 0.1);
                    wingsGroup.add(leftFeather);
                    
                    // Ø§Ù„Ø¬Ù†Ø§Ø­ Ø§Ù„Ø£ÙŠÙ…Ù†
                    const rightFeather = leftFeather.clone();
                    rightFeather.position.x = 0.5 + (layer * 0.3);
                    rightFeather.rotation.z = 0.3 + (layer * 0.1);
                    wingsGroup.add(rightFeather);
                }
            }
            
            player.add(wingsGroup);
        }
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ù‡Ø§Ù„Ø© Ù…Ù„ÙƒÙŠØ©
        function createRoyalHalo() {
            const haloGroup = new THREE.Group();
            haloGroup.name = "royalHalo";
            
            // Ø§Ù„Ø­Ù„Ù‚Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            const mainHaloGeometry = new THREE.TorusGeometry(1, 0.1, 16, 100);
            const mainHaloMaterial = new THREE.MeshBasicMaterial({
                color: 0x3498db,
                transparent: true,
                opacity: 0.6,
                side: THREE.DoubleSide
            });
            const mainHalo = new THREE.Mesh(mainHaloGeometry, mainHaloMaterial);
            mainHalo.rotation.x = Math.PI / 2;
            haloGroup.add(mainHalo);
            
            // Ø­Ù„Ù‚Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©
            for (let i = 0; i < 3; i++) {
                const ringGeometry = new THREE.RingGeometry(0.8 + (i * 0.3), 0.85 + (i * 0.3), 32);
                const ringMaterial = new THREE.MeshBasicMaterial({
                    color: 0x2ecc71,
                    transparent: true,
                    opacity: 0.3 - (i * 0.1),
                    side: THREE.DoubleSide
                });
                const ring = new THREE.Mesh(ringGeometry, ringMaterial);
                ring.rotation.x = Math.PI / 2;
                ring.position.y = (i - 1) * 0.2;
                haloGroup.add(ring);
            }
            
            // Ø¬Ø³ÙŠÙ…Ø§Øª Ø·Ø§Ø¦Ø±Ø© Ø­ÙˆÙ„ Ø§Ù„Ù‡Ø§Ù„Ø©
            for (let i = 0; i < 50; i++) {
                const particleGeometry = new THREE.SphereGeometry(0.03, 8, 8);
                const particleMaterial = new THREE.MeshBasicMaterial({
                    color: 0xf1c40f,
                    transparent: true,
                    opacity: 0.7
                });
                const particle = new THREE.Mesh(particleGeometry, particleMaterial);
                
                const angle = Math.random() * Math.PI * 2;
                const radius = 1 + Math.random() * 0.5;
                const height = (Math.random() - 0.5) * 0.6;
                
                particle.position.set(
                    Math.cos(angle) * radius,
                    height,
                    Math.sin(angle) * radius
                );
                
                particle.userData = {
                    angle: angle,
                    radius: radius,
                    height: height,
                    speed: 0.5 + Math.random() * 1
                };
                
                haloGroup.add(particle);
            }
            
            haloGroup.position.y = 2.5;
            player.add(haloGroup);
        }
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø³ÙŠÙ…Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨
        function createPlayerParticles() {
            const particlesGroup = new THREE.Group();
            particlesGroup.name = "playerParticles";
            
            // Ø¬Ø³ÙŠÙ…Ø§Øª Ø§Ù„Ø·Ø§Ù‚Ø©
            for (let i = 0; i < 100; i++) {
                const size = 0.05 + Math.random() * 0.1;
                const geometry = new THREE.SphereGeometry(size, 8, 8);
                const material = new THREE.MeshBasicMaterial({
                    color: 0x3498db,
                    transparent: true,
                    opacity: 0.7
                });
                const particle = new THREE.Mesh(geometry, material);
                
                // ØªÙˆØ²ÙŠØ¹ Ø­ÙˆÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨
                const radius = 2 + Math.random() * 3;
                const theta = Math.random() * Math.PI * 2;
                const phi = Math.random() * Math.PI;
                
                particle.position.set(
                    radius * Math.sin(phi) * Math.cos(theta),
                    radius * Math.cos(phi),
                    radius * Math.sin(phi) * Math.sin(theta)
                );
                
                particle.userData = {
                    radius: radius,
                    theta: theta,
                    phi: phi,
                    speed: 0.5 + Math.random() * 1,
                    size: size
                };
                
                particlesGroup.add(particle);
            }
            
            player.add(particlesGroup);
        }
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ø§Ù„Ù… Ø®ÙŠØ§Ù„ÙŠ Ø®Ø§Ø±Ù‚
        function createUltraFantasyWorld() {
            world = new THREE.Group();
            world.name = "UltraFantasyWorld";
            
            // ===== Ø§Ù„Ø£Ø±Ø¶ÙŠØ© Ø§Ù„Ø®Ø§Ø±Ù‚Ø© =====
            updateLoading("ğŸŒ± Ø¥Ù†Ø´Ø§Ø¡ ØªØ¶Ø§Ø±ÙŠØ³ ÙƒÙˆÙ†ÙŠØ©...", 81);
            
            const groundGeometry = new THREE.PlaneGeometry(1000, 1000, 200, 200);
            const groundMaterial = new THREE.MeshStandardMaterial({
                color: 0x90EE90,
                roughness: 0.8,
                metalness: 0.2,
                side: THREE.DoubleSide
            });
            
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = -Math.PI / 2;
            ground.position.y = -10;
            ground.receiveShadow = true;
            ground.castShadow = true;
            world.add(ground);
            
            // ===== Ø§Ù„Ø¬Ø¨Ø§Ù„ Ø§Ù„Ø¹Ù…Ù„Ø§Ù‚Ø© =====
            updateLoading("ğŸ”ï¸ Ø¨Ù†Ø§Ø¡ Ø³Ù„Ø§Ø³Ù„ Ø¬Ø¨Ø§Ù„ Ù‡Ø§Ø¦Ù„Ø©...", 82);
            createMountainRange(50);
            
            // ===== Ø§Ù„ØºØ§Ø¨Ø© Ø§Ù„Ø³Ø­Ø±ÙŠØ© =====
            updateLoading("ğŸŒ³ Ø¥Ù†Ø´Ø§Ø¡ ØºØ§Ø¨Ø© Ø®ÙŠØ§Ù„ÙŠØ©...", 83);
            createMagicForest(200);
            
            // ===== Ø§Ù„Ø£Ù†Ù‡Ø§Ø± Ø§Ù„Ø¨Ù„ÙˆØ±ÙŠØ© =====
            updateLoading("ğŸ’ ØªØ´ÙƒÙŠÙ„ Ø£Ù†Ù‡Ø§Ø± Ù…Ù† Ø§Ù„Ø¨Ù„ÙˆØ±...", 84);
            createCrystalRivers(5);
            
            // ===== Ø§Ù„Ù‚Ù„Ø¹Ø© Ø§Ù„Ø³Ù…Ø§ÙˆÙŠØ© =====
            updateLoading("ğŸ° Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù‚Ù„Ø¹Ø© Ø§Ù„Ù…Ù„ÙƒÙŠØ©...", 85);
            createSkyCastle();
            
            // ===== Ø§Ù„Ø¬Ø³ÙˆØ± Ø§Ù„Ø·Ø§ÙÙŠØ© =====
            updateLoading("ğŸŒ‰ Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø³ÙˆØ± Ø·Ø§ÙÙŠØ©...", 86);
            createFloatingBridges(3);
            
            // ===== Ø§Ù„Ø¬Ø²Ø± Ø§Ù„Ø¹Ø§Ø¦Ù…Ø© =====
            updateLoading("ğŸï¸ ØªØ´ÙƒÙŠÙ„ Ø¬Ø²Ø± Ø¹Ø§Ø¦Ù…Ø©...", 87);
            createFloatingIslands(15);
            
            // ===== Ø§Ù„Ù…Ø¹Ø§Ø¨Ø¯ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© =====
            updateLoading("ğŸ›• Ø¨Ù†Ø§Ø¡ Ù…Ø¹Ø§Ø¨Ø¯ ØºØ§Ù…Ø¶Ø©...", 88);
            createAncientTemples(8);
            
            // ===== Ø§Ù„Ù…Ø¯Ù† Ø§Ù„Ø·Ø§Ø¦Ø±Ø© =====
            updateLoading("ğŸ™ï¸ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¯Ù† Ø·Ø§Ø¦Ø±Ø©...", 89);
            createFloatingCities(5);
            
            scene.add(world);
            console.log("ğŸŒ Ø§Ù„Ø¹Ø§Ù„Ù… Ø§Ù„Ø®ÙŠØ§Ù„ÙŠ Ø§Ù„Ø®Ø§Ø±Ù‚ ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡!");
        }
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø³Ù„Ø§Ø³Ù„ Ø¬Ø¨Ø§Ù„
        function createMountainRange(count) {
            const mountainGroup = new THREE.Group();
            
            for (let i = 0; i < count; i++) {
                const mountain = new THREE.Group();
                
                // Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø¬Ø¨Ù„
                const height = 30 + Math.random() * 70;
                const baseSize = 10 + Math.random() * 20;
                
                // Ø§Ù„Ø¬Ø¨Ù„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
                const mountainGeometry = new THREE.ConeGeometry(baseSize, height, 8 + Math.floor(Math.random() * 8));
                const mountainMaterial = new THREE.MeshStandardMaterial({
                    color: 0x7f8c8d,
                    roughness: 0.9,
                    metalness: 0.1
                });
                const mainMountain = new THREE.Mesh(mountainGeometry, mountainMaterial);
                mainMountain.castShadow = true;
                mainMountain.receiveShadow = true;
                mountain.add(mainMountain);
                
                // Ù‚Ù…Ø© Ø§Ù„Ø¬Ø¨Ù„ Ø§Ù„Ù…ØºØ·Ø§Ø© Ø¨Ø§Ù„Ø«Ù„Ø¬
                const snowGeometry = new THREE.SphereGeometry(baseSize * 0.3, 8, 8);
                const snowMaterial = new THREE.MeshStandardMaterial({
                    color: 0xFFFFFF,
                    roughness: 0.7,
                    metalness: 0
                });
                const snow = new THREE.Mesh(snowGeometry, snowMaterial);
                snow.position.y = height / 2 + 2;
                snow.castShadow = true;
                mountain.add(snow);
                
                // ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹ Ø¹Ø´ÙˆØ§Ø¦ÙŠ
                const angle = Math.random() * Math.PI * 2;
                const distance = 200 + Math.random() * 300;
                
                mountain.position.set(
                    Math.cos(angle) * distance,
                    -10,
                    Math.sin(angle) * distance
                );
                
                mountain.rotation.y = Math.random() * Math.PI * 2;
                mountain.scale.setScalar(0.8 + Math.random() * 1.2);
                
                mountainGroup.add(mountain);
            }
            
            world.add(mountainGroup);
        }
        
        // Ø¥Ù†Ø´Ø§Ø¡ ØºØ§Ø¨Ø© Ø³Ø­Ø±ÙŠØ©
        function createMagicForest(count) {
            const forestGroup = new THREE.Group();
            
            for (let i = 0; i < count; i++) {
                const tree = new THREE.Group();
                
                // Ø¬Ø°Ø¹ Ø§Ù„Ø´Ø¬Ø±Ø©
                const trunkHeight = 5 + Math.random() * 10;
                const trunkGeometry = new THREE.CylinderGeometry(0.8, 1.2, trunkHeight, 8);
                const trunkMaterial = new THREE.MeshStandardMaterial({
                    color: 0x8B4513,
                    roughness: 0.9,
                    metalness: 0
                });
                const trunk = new THREE.Mesh(trunkGeometry, trunkMaterial);
                trunk.castShadow = true;
                trunk.receiveShadow = true;
                tree.add(trunk);
                
                // ØªØ§Ø¬ Ø§Ù„Ø´Ø¬Ø±Ø© (Ø£ÙˆØ±Ø§Ù‚)
                const leavesCount = 3 + Math.floor(Math.random() * 4);
                for (let j = 0; j < leavesCount; j++) {
                    const leavesGeometry = new THREE.SphereGeometry(2 + Math.random() * 3, 8, 8);
                    const leavesColor = new THREE.Color(
                        0.1 + Math.random() * 0.2,
                        0.5 + Math.random() * 0.3,
                        0.1 + Math.random() * 0.2
                    );
                    const leavesMaterial = new THREE.MeshStandardMaterial({
                        color: leavesColor,
                        roughness: 0.8,
                        metalness: 0,
                        transparent: true,
                        alphaTest: 0.5
                    });
                    const leaves = new THREE.Mesh(leavesGeometry, leavesMaterial);
                    leaves.position.y = trunkHeight / 2 + 1 + (j * 2);
                    leaves.castShadow = true;
                    tree.add(leaves);
                }
                
                // Ø£Ø¶ÙˆØ§Ø¡ Ø³Ø­Ø±ÙŠØ© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø´Ø¬Ø§Ø±
                const lightColor = new THREE.Color(
                    Math.random(),
                    Math.random(),
                    Math.random()
                );
                const treeLight = new THREE.PointLight(lightColor, 0.5, 20);
                treeLight.position.y = trunkHeight / 2 + 3;
                tree.add(treeLight);
                
                // Ù…ÙˆÙ‚Ø¹ Ø¹Ø´ÙˆØ§Ø¦ÙŠ ÙÙŠ Ø§Ù„ØºØ§Ø¨Ø©
                const angle = Math.random() * Math.PI * 2;
                const distance = 50 + Math.random() * 150;
                
                tree.position.set(
                    Math.cos(angle) * distance,
                    -10,
                    Math.sin(angle) * distance
                );
                
                tree.rotation.y = Math.random() * Math.PI * 2;
                tree.scale.setScalar(0.7 + Math.random() * 1.3);
                
                forestGroup.add(tree);
            }
            
            world.add(forestGroup);
        }
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø£Ù†Ù‡Ø§Ø± Ø¨Ù„ÙˆØ±ÙŠØ©
        function createCrystalRivers(count) {
            for (let i = 0; i < count; i++) {
                const riverGroup = new THREE.Group();
                
                // Ù…Ø³Ø§Ø± Ø§Ù„Ù†Ù‡Ø±
                const riverLength = 100 + Math.random() * 200;
                const riverWidth = 5 + Math.random() * 10;
                
                const riverGeometry = new THREE.PlaneGeometry(riverLength, riverWidth, 50, 5);
                const riverMaterial = new THREE.MeshStandardMaterial({
                    color: 0x1E90FF,
                    roughness: 0.1,
                    metalness: 0.9,
                    transparent: true,
                    opacity: 0.7,
                    side: THREE.DoubleSide
                });
                
                const river = new THREE.Mesh(riverGeometry, riverMaterial);
                river.rotation.x = -Math.PI / 2;
                river.position.y = -9.5;
                
                // ØªØ­Ø¯ÙŠØ¯ Ù…Ø³Ø§Ø± Ù…ØªØ¹Ø±Ø¬ Ù„Ù„Ù†Ù‡Ø±
                const startAngle = Math.random() * Math.PI * 2;
                const startX = Math.cos(startAngle) * 200;
                const startZ = Math.sin(startAngle) * 200;
                
                river.position.x = startX;
                river.position.z = startZ;
                river.rotation.y = startAngle;
                
                river.receiveShadow = true;
                riverGroup.add(river);
                
                // Ø¬Ø³ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù†Ù‡Ø±
                const bridgeCount = Math.floor(riverLength / 30);
                for (let j = 0; j < bridgeCount; j++) {
                    const bridge = createCrystalBridge();
                    bridge.position.x = (j - bridgeCount/2) * 30;
                    bridge.position.y = -8;
                    riverGroup.add(bridge);
                }
                
                world.add(riverGroup);
            }
        }
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø³Ø± Ø¨Ù„ÙˆØ±ÙŠ
        function createCrystalBridge() {
            const bridge = new THREE.Group();
            
            // Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¬Ø³Ø±
            const baseGeometry = new THREE.BoxGeometry(25, 1, 8);
            const baseMaterial = new THREE.MeshStandardMaterial({
                color: 0x87CEEB,
                metalness: 0.8,
                roughness: 0.2,
                transparent: true,
                opacity: 0.8
            });
            const base = new THREE.Mesh(baseGeometry, baseMaterial);
            base.castShadow = true;
            bridge.add(base);
            
            // Ø£Ø¹Ù…Ø¯Ø© Ø¨Ù„ÙˆØ±ÙŠØ©
            for (let i = -10; i <= 10; i += 5) {
                const columnGeometry = new THREE.CylinderGeometry(0.5, 0.7, 3, 8);
                const columnMaterial = new THREE.MeshStandardMaterial({
                    color: 0x00BFFF,
                    metalness: 0.9,
                    roughness: 0.1,
                    transparent: true,
                    opacity: 0.9
                });
                const column = new THREE.Mesh(columnGeometry, columnMaterial);
                column.position.set(i, -1.5, 0);
                column.castShadow = true;
                bridge.add(column);
            }
            
            return bridge;
        }
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ù„Ø¹Ø© Ø³Ù…Ø§ÙˆÙŠØ©
        function createSkyCastle() {
            const castle = new THREE.Group();
            castle.position.y = 100;
            
            // Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¹Ø§Ø¦Ù…Ø©
            const baseGeometry = new THREE.CylinderGeometry(40, 50, 10, 16);
            const baseMaterial = new THREE.MeshStandardMaterial({
                color: 0x696969,
                metalness: 0.7,
                roughness: 0.3
            });
            const base = new THREE.Mesh(baseGeometry, baseMaterial);
            base.castShadow = true;
            castle.add(base);
            
            // Ø§Ù„Ø¬Ø¯Ø±Ø§Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            const wallGeometry = new THREE.BoxGeometry(80, 30, 80);
            const wallMaterial = new THREE.MeshStandardMaterial({
                color: 0x7f8c8d,
                metalness: 0.6,
                roughness: 0.4
            });
            const walls = new THREE.Mesh(wallGeometry, wallMaterial);
            walls.position.y = 20;
            walls.castShadow = true;
            castle.add(walls);
            
            // Ø§Ù„Ø£Ø¨Ø±Ø§Ø¬
            const towerPositions = [
                [-35, 40, -35], [-35, 40, 35], [35, 40, -35], [35, 40, 35]
            ];
            
            towerPositions.forEach(pos => {
                const tower = createMagicTower();
                tower.position.set(pos[0], pos[1], pos[2]);
                castle.add(tower);
            });
            
            world.add(castle);
        }
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø±Ø¬ Ø³Ø­Ø±ÙŠ
        function createMagicTower() {
            const tower = new THREE.Group();
            
            // Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø¨Ø±Ø¬
            const towerGeometry = new THREE.CylinderGeometry(8, 10, 40, 16);
            const towerMaterial = new THREE.MeshStandardMaterial({
                color: 0x8e44ad,
                metalness: 0.8,
                roughness: 0.2
            });
            const mainTower = new THREE.Mesh(towerGeometry, towerMaterial);
            mainTower.castShadow = true;
            tower.add(mainTower);
            
            // Ù‚Ù…Ø© Ø§Ù„Ø¨Ø±Ø¬
            const spireGeometry = new THREE.ConeGeometry(6, 15, 8);
            const spireMaterial = new THREE.MeshStandardMaterial({
                color: 0xf1c40f,
                metalness: 0.9,
                roughness: 0.1
            });
            const spire = new THREE.Mesh(spireGeometry, spireMaterial);
            spire.position.y = 27.5;
            spire.castShadow = true;
            tower.add(spire);
            
            // ÙƒØ±Ø© Ø·Ø§Ù‚Ø© ÙÙŠ Ø§Ù„Ù‚Ù…Ø©
            const energyBallGeometry = new THREE.SphereGeometry(3, 16, 16);
            const energyBallMaterial = new THREE.MeshBasicMaterial({
                color: 0x00FF00,
                transparent: true,
                opacity: 0.8
            });
            const energyBall = new THREE.Mesh(energyBallGeometry, energyBallMaterial);
            energyBall.position.y = 35;
            tower.add(energyBall);
            
            return tower;
        }
        
        // (Ø³ÙŠØªÙ… Ø§Ø³ØªÙƒÙ…Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯ ÙÙŠ Ø§Ù„Ø±Ø¯ Ø§Ù„ØªØ§Ù„ÙŠ Ø¨Ø³Ø¨Ø¨ Ø·ÙˆÙ„Ù‡...)
        
        // Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø®Ø§Ø±Ù‚
        function setupUltraControlSystem() {
            // Ø¬ÙˆÙŠØ³ØªÙŠÙƒ
            const joystickHandle = document.getElementById('joystickHandle');
            const joystickArea = document.getElementById('joystickArea');
            
            joystickArea.addEventListener('touchstart', (e) => {
                e.preventDefault();
                isDragging = true;
                touchId = e.changedTouches[0].identifier;
                updateJoystickPosition(e.changedTouches[0]);
            });
            
            joystickArea.addEventListener('touchmove', (e) => {
                if (!isDragging) return;
                e.preventDefault();
                
                const touch = Array.from(e.changedTouches).find(t => t.identifier === touchId);
                if (touch) updateJoystickPosition(touch);
            });
            
            document.addEventListener('touchend', (e) => {
                if (isDragging && Array.from(e.changedTouches).some(t => t.identifier === touchId)) {
                    isDragging = false;
                    moveVector.x = 0;
                    moveVector.y = 0;
                    joystickHandle.style.transform = 'translate(-50%, -50%)';
                    touchId = null;
                }
            });
            
            function updateJoystickPosition(touch) {
                const rect = joystickArea.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;
                
                let deltaX = touch.clientX - centerX;
                let deltaY = touch.clientY - centerY;
                
                const maxDistance = rect.width / 2 - 60;
                const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
                
                if (distance > maxDistance) {
                    const angle = Math.atan2(deltaY, deltaX);
                    deltaX = Math.cos(angle) * maxDistance;
                    deltaY = Math.sin(angle) * maxDistance;
                }
                
                moveVector.x = deltaX / maxDistance;
                moveVector.y = deltaY / maxDistance;
                
                joystickHandle.style.transform = `translate(${deltaX}px, ${deltaY}px)`;
            }
            
            // Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ…
            setupActionButton('jumpBtn', ultraJump);
            setupActionButton('attackBtn', ultraAttack);
            setupActionButton('specialBtn', ultraSpecial);
            setupActionButton('danceBtn', ultraDance);
            
            function setupActionButton(btnId, action) {
                const btn = document.getElementById(btnId);
                if (!btn) return;
                
                btn.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    btn.style.transform = 'scale(0.85)';
                    action();
                });
                
                btn.addEventListener('touchend', () => {
                    btn.style.transform = 'scale(1)';
                });
                
                btn.addEventListener('click', action);
            }
        }
        
        // Ø­Ø±ÙƒØ§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø®Ø§Ø±Ù‚Ø©
        function ultraJump() {
            if (!isJumping && player) {
                isJumping = true;
                player.position.y += 3;
                
                createJumpEffect();
                addScore(100);
                updateMissionProgress('jump');
                
                setTimeout(() => {
                    player.position.y = 3;
                    isJumping = false;
                }, 600);
            }
        }
        
        function ultraAttack() {
            if (!isAttacking) {
                isAttacking = true;
                
                // Ø­Ø±ÙƒØ© Ø§Ù„Ù‡Ø¬ÙˆÙ…
                const rightArm = player.getObjectByName('rightArm');
                if (rightArm) {
                    rightArm.rotation.z = -Math.PI / 2;
                }
                
                // ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ù‡Ø¬ÙˆÙ…
                createAttackEffect();
                
                // Ù†Ø¸Ø§Ù… Ø§Ù„ÙƒÙˆÙ…Ø¨Ùˆ
                combo++;
                updateCombo();
                
                // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†Ù‚Ø§Ø·
                addScore(150 * combo);
                
                setTimeout(() => {
                    if (rightArm) rightArm.rotation.z = 0;
                    isAttacking = false;
                }, 300);
            }
        }
        
        function ultraSpecial() {
            if (energy >= 40 && !isSpecialActive) {
                energy -= 40;
                updateEnergy();
                isSpecialActive = true;
                
                // ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ù‚ÙˆØ© Ø§Ù„Ø®Ø§ØµØ©
                createSpecialEffect();
                addScore(500);
                updateMissionProgress('special');
                
                setTimeout(() => {
                    isSpecialActive = false;
                }, 3000);
            }
        }
        
        function ultraDance() {
            if (!isDancing) {
                isDancing = true;
                addScore(50);
                
                const startTime = Date.now();
                function danceAnimation() {
                    const elapsed = Date.now() - startTime;
                    if (elapsed < 5000) {
                        player.rotation.y += 0.05;
                        requestAnimationFrame(danceAnimation);
                    } else {
                        player.rotation.y = 0;
                        isDancing = false;
                    }
                }
                danceAnimation();
            }
        }
        
        // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØµØ­ÙŠØ­
        function updateDebugInfo() {
            const fpsElement = document.getElementById('fpsCounter');
            const trianglesElement = document.getElementById('triangleCounter');
            const memoryElement = document.getElementById('memoryCounter');
            const drawCallElement = document.getElementById('drawCallCounter');
            
            if (fpsElement) fpsElement.textContent = fps;
            if (trianglesElement) trianglesElement.textContent = performanceStats.triangles.toLocaleString();
            if (memoryElement) memoryElement.textContent = performanceStats.memory + 'MB';
            if (drawCallElement) drawCallElement.textContent = performanceStats.drawCalls;
        }
        
        // Ø§Ù„Ø­Ù„Ù‚Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        function animate() {
            requestAnimationFrame(animate);
            
            const delta = clock.getDelta();
            frameCount++;
            
            // ØªØ­Ø¯ÙŠØ« FPS
            const now = performance.now();
            if (now >= lastTime + 1000) {
                fps = Math.round((frameCount * 1000) / (now - lastTime));
                frameCount = 0;
                lastTime = now;
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù„Ø§Ø¹Ø¨
            if (player) updatePlayer(delta);
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
            if (camera) updateCamera(delta);
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ£Ø«ÙŠØ±Ø§Øª
            updateEffects(delta);
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø¯Ø§Ø¡
            if (renderer) {
                performanceStats.triangles = renderer.info.render.triangles;
                performanceStats.drawCalls = renderer.info.render.calls;
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø°Ø§ÙƒØ±Ø©
            if (performance.memory) {
                performanceStats.memory = Math.round(performance.memory.usedJSHeapSize / 1024 / 1024);
            }
            
            // Ø§Ù„Ø¹Ø±Ø¶
            if (renderer && scene && camera) {
                renderer.render(scene, camera);
            }
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù„Ø§Ø¹Ø¨
        function updatePlayer(delta) {
            if (isDancing) return;
            
            // Ø§Ù„Ø­Ø±ÙƒØ©
            const moveSpeed = player.userData.speed;
            player.position.x += moveVector.x * moveSpeed;
            player.position.z += -moveVector.y * moveSpeed;
            
            // Ø§Ù„Ø¯ÙˆØ±Ø§Ù†
            if (Math.abs(moveVector.x) > 0.1 || Math.abs(moveVector.y) > 0.1) {
                player.rotation.y = Math.atan2(moveVector.x, -moveVector.y);
            }
            
            // Ø­Ø±ÙƒØ© Ø§Ù„ØªÙ†ÙØ³
            player.position.y = 3 + Math.sin(Date.now() * 0.001) * 0.1;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‡Ø§Ù„Ø©
            const halo = player.getObjectByName('royalHalo');
            if (halo) {
                halo.rotation.y += delta * 0.5;
                
                // Ø¬Ø¹Ù„ Ø§Ù„Ø¬Ø³ÙŠÙ…Ø§Øª ØªØªØ­Ø±Ùƒ
                halo.children.forEach(child => {
                    if (child.userData && child.userData.speed) {
                        child.userData.angle += delta * child.userData.speed;
                        child.position.x = Math.cos(child.userData.angle) * child.userData.radius;
                        child.position.z = Math.sin(child.userData.angle) * child.userData.radius;
                    }
                });
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø¬Ù†Ø­Ø©
            const wings = player.getObjectByName('royalWings');
            if (wings) {
                wings.rotation.y = Math.sin(Date.now() * 0.002) * 0.2;
            }
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
        function updateCamera(delta) {
            const targetPosition = new THREE.Vector3(
                player.position.x,
                player.position.y + 8,
                player.position.z + 12
            );
            
            camera.position.lerp(targetPosition, 0.1);
            camera.lookAt(player.position.x, player.position.y + 2, player.position.z);
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ø§Ù‚Ø©
        function updateEnergy() {
            const energyElement = document.getElementById('energy');
            if (energyElement) energyElement.textContent = Math.floor(energy) + '%';
        }
        
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†Ù‚Ø§Ø·
        function addScore(points) {
            score += points;
            const scoreElement = document.getElementById('score');
            if (scoreElement) {
                scoreElement.textContent = score.toLocaleString();
                scoreElement.style.animation = 'none';
                setTimeout(() => {
                    scoreElement.style.animation = 'pulse 0.5s';
                }, 10);
            }
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒÙˆÙ…Ø¨Ùˆ
        function updateCombo() {
            if (combo > 1) {
                const comboDisplay = document.getElementById('comboDisplay');
                const comboCount = document.getElementById('comboCount');
                
                if (comboDisplay && comboCount) {
                    comboDisplay.style.display = 'block';
                    comboCount.textContent = combo;
                    
                    clearTimeout(comboTimeout);
                    comboTimeout = setTimeout(() => {
                        combo = 0;
                        comboDisplay.style.display = 'none';
                    }, 3000);
                }
                
                updateMissionProgress('combo');
            }
        }
        
        // Ø¨Ø¯Ø¡ Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
        function startGameSystems() {
            // ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„Ø·Ø§Ù‚Ø©
            setInterval(() => {
                if (energy < 100) {
                    energy = Math.min(100, energy + 0.5);
                    updateEnergy();
                }
            }, 1000);
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù‡Ù…Ø©
            setInterval(updateMission, 5000);
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø§Ù„Ù…
            setInterval(updateWorld, 100);
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù‡Ù…Ø©
        function updateMission() {
            const mission = MISSIONS[currentMission];
            if (!mission) return;
            
            const progress = (mission.current / mission.target) * 100;
            const progressBar = document.getElementById('missionProgress');
            const missionText = document.getElementById('missionText');
            const rewardAmount = document.getElementById('rewardAmount');
            
            if (progressBar) progressBar.style.width = `${progress}%`;
            if (missionText) missionText.textContent = mission.name;
            if (rewardAmount) rewardAmount.textContent = mission.reward.toLocaleString();
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ù‡Ù…Ø©
            if (mission.current >= mission.target) {
                completeMission(mission);
                currentMission = (currentMission + 1) % MISSIONS.length;
            }
        }
        
        // ØªØ­Ø¯ÙŠØ« ØªÙ‚Ø¯Ù… Ø§Ù„Ù…Ù‡Ù…Ø©
        function updateMissionProgress(type) {
            const mission = MISSIONS[currentMission];
            if (mission && mission.type === type) {
                mission.current++;
            }
        }
        
        // Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ù‡Ù…Ø©
        function completeMission(mission) {
            addScore(mission.reward);
            showNotification(`ğŸ‰ Ø£ÙƒÙ…Ù„Øª Ø§Ù„Ù…Ù‡Ù…Ø©: ${mission.name}!`, '#2ecc71');
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ù‡Ù…Ø©
            mission.current = 0;
        }
        
        // Ø¹Ø±Ø¶ Ø¥Ø´Ø¹Ø§Ø±
        function showNotification(message, color = '#3498db') {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.style.borderImage = `linear-gradient(45deg, ${color}, #ffffff) 1`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // Ø£Ù†ÙŠÙ…ÙŠØ´Ù†
            notification.style.animation = 'none';
            setTimeout(() => {
                notification.style.animation = 'fadeInOut 3s ease-in-out';
            }, 10);
            
            // Ø¥Ø²Ø§Ù„Ø© Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù†ÙŠ
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
        
        // Ù…Ø¹Ø§Ù„Ø¬Ø© ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø¬Ù…
        function onWindowResize() {
            if (camera && renderer) {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            }
        }
        
        // Ø¹Ø±Ø¶ Ø´Ø§Ø´Ø© Ø§Ù„Ø®Ø·Ø£
        function showErrorScreen(error) {
            document.getElementById('loadingScreen').innerHTML = `
                <div style="text-align: center; padding: 50px; max-width: 800px;">
                    <h1 style="color: #e74c3c; font-size: 48px; margin-bottom: 30px;">
                        <i class="fas fa-exclamation-triangle"></i> Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø­Ø±Ùƒ
                    </h1>
                    <div style="background: rgba(231, 76, 60, 0.1); padding: 30px; border-radius: 20px; margin: 30px 0;">
                        <p style="font-size: 20px; color: #e74c3c; margin-bottom: 20px;">
                            ${error.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}
                        </p>
                        <pre style="
                            background: rgba(0, 0, 0, 0.5); 
                            padding: 20px; 
                            border-radius: 10px; 
                            text-align: left; 
                            overflow: auto; 
                            max-height: 200px;
                            font-family: monospace;
                        ">${error.stack || 'Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙØ§ØµÙŠÙ„'}</pre>
                    </div>
                    <div style="display: flex; gap: 20px; justify-content: center; flex-wrap: wrap;">
                        <button onclick="location.reload()" style="
                            background: linear-gradient(145deg, #3498db, #2980b9);
                            color: white;
                            border: none;
                            padding: 20px 40px;
                            font-size: 20px;
                            border-radius: 15px;
                            cursor: pointer;
                            display: flex;
                            align-items: center;
                            gap: 10px;
                            transition: transform 0.3s;
                        ">
                            <i class="fas fa-redo"></i> Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„
                        </button>
                        <button onclick="initializeUltraGraphicsEngine()" style="
                            background: linear-gradient(145deg, #2ecc71, #27ae60);
                            color: white;
                            border: none;
                            padding: 20px 40px;
                            font-size: 20px;
                            border-radius: 15px;
                            cursor: pointer;
                            display: flex;
                            align-items: center;
                            gap: 10px;
                            transition: transform 0.3s;
                        ">
                            <i class="fas fa-play"></i> Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰
                        </button>
                    </div>
                    <div style="margin-top: 40px; color: #7f8c8d; font-size: 16px;">
                        <p><i class="fas fa-info-circle"></i> Ù†ØµÙŠØ­Ø©: ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ØªØµÙØ­ Ø­Ø¯ÙŠØ« Ù…Ø«Ù„ Chrome Ø£Ùˆ Firefox</p>
                        <p><i class="fas fa-bolt"></i> ØªÙØ¹ÙŠÙ„ ØªØ³Ø±ÙŠØ¹ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ù‚Ø¯ ÙŠØ­Ù„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©</p>
                    </div>
                </div>
            `;
        }
        
        // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù„Ø¹Ø¨Ø© ØªØ¹Ù…Ù„
        setTimeout(() => {
            const loadingScreen = document.getElementById('loadingScreen');
            if (loadingScreen && loadingScreen.style.display !== 'none') {
                console.log("âš ï¸ ØªØ¬Ø§ÙˆØ² Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·ÙˆÙŠÙ„...");
                loadingScreen.style.display = 'none';
                if (!scene && window.THREE) {
                    console.log("ğŸ”„ Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø­Ø±Ùƒ ÙŠØ¯ÙˆÙŠØ§Ù‹...");
                    initializeUltraGraphicsEngine();
                }
            }
        }, 30000); // 30 Ø«Ø§Ù†ÙŠØ© ÙƒØ­Ø¯ Ø£Ù‚ØµÙ‰ Ù„Ù„Ø§Ù†ØªØ¸Ø§Ø±
    </script>
</body>
</html>
