<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù„Ø¹Ø¨Ø© Ø§Ù„Ø±Ù…Ø§ÙŠØ© Ø§Ù„Ù…ØªØ·ÙˆØ±Ø© - 2D Shooter</title>
<style>
body {
    margin:0;
    padding:0;
    background: linear-gradient(180deg, #0a0a2a 0%, #000 100%);
    overflow:hidden;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    color: white;
    touch-action: manipulation;
}

#game {
    background: #000;
    display:block;
    margin:auto;
    border: 2px solid #00ffff;
    box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
    border-radius: 5px;
}

#gameUI {
    position: absolute;
    top: 10px;
    left: 0;
    width: 100%;
    text-align: center;
    pointer-events: none;
    z-index: 10;
}

#scoreDisplay {
    font-size: 24px;
    font-weight: bold;
    color: #ffcc00;
    text-shadow: 0 0 5px #ff6600;
    margin-bottom: 5px;
}

#hpDisplay, #weaponDisplay {
    font-size: 18px;
    margin: 5px 0;
}

#gameOverScreen, #pauseScreen {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.85);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 100;
    display: none;
}

#gameOverScreen h2 {
    color: #ff3333;
    font-size: 40px;
    margin-bottom: 10px;
    text-shadow: 0 0 10px red;
}

#pauseScreen h2 {
    color: #ffff00;
    font-size: 40px;
    margin-bottom: 10px;
    text-shadow: 0 0 10px yellow;
}

.screenContent {
    text-align: center;
    max-width: 80%;
}

.btn {
    position:fixed;
    width:70px;
    height:70px;
    background:rgba(50, 50, 150, 0.7);
    border-radius:50%;
    color:white;
    text-align:center;
    line-height:70px;
    font-size:24px;
    user-select:none;
    border: 2px solid rgba(100, 200, 255, 0.8);
    box-shadow: 0 0 10px rgba(100, 200, 255, 0.5);
    transition: all 0.1s;
    touch-action: manipulation;
    z-index: 20;
}

.btn:active {
    transform: scale(0.9);
    background: rgba(80, 120, 200, 0.9);
}

#left { bottom:80px; left:20px; }
#right { bottom:80px; left:120px; }
#up { bottom:160px; left:70px; }
#down { bottom:0px; left:70px; }
#fire { 
    bottom:60px; 
    right:30px; 
    background: linear-gradient(red, #990000);
    border-color: #ff6666;
    box-shadow: 0 0 15px rgba(255, 50, 50, 0.8);
    font-size: 30px;
}
#pauseBtn {
    top: 15px;
    right: 15px;
    width: 50px;
    height: 50px;
    line-height: 50px;
    font-size: 18px;
    background: rgba(100, 100, 200, 0.7);
}

#controlsInfo {
    position: fixed;
    bottom: 10px;
    right: 10px;
    color: #aaa;
    font-size: 12px;
    text-align: right;
}

.upgrade {
    position: absolute;
    width: 15px;
    height: 15px;
    border-radius: 50%;
    z-index: 5;
}

.healthUpgrade { background: radial-gradient(#ff0000, #990000); }
.weaponUpgrade { background: radial-gradient(#00ff00, #009900); }
.shieldUpgrade { background: radial-gradient(#0088ff, #0044aa); }
.speedUpgrade { background: radial-gradient(#ffff00, #aa9900); }

.particle {
    position: absolute;
    border-radius: 50%;
    pointer-events: none;
    z-index: 3;
}

.boss {
    background: radial-gradient(#ff00ff, #990099);
    border: 2px solid #ffccff;
    box-shadow: 0 0 15px #ff00ff;
}

.enemyBullet {
    background: radial-gradient(#ff9900, #cc6600);
    border: 1px solid #ffcc00;
}

.gameBtn {
    padding: 15px 30px;
    margin: 10px;
    background: linear-gradient(#3366ff, #0033cc);
    border: none;
    border-radius: 10px;
    color: white;
    font-size: 20px;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 5px 0 #002266;
    transition: all 0.1s;
    touch-action: manipulation;
}

.gameBtn:active {
    transform: translateY(5px);
    box-shadow: 0 0 0 #002266;
}
</style>
</head>
<body>

<canvas id="game" width="360" height="640"></canvas>

<div id="gameUI">
    <div id="scoreDisplay">Ø§Ù„Ù†Ù‚Ø§Ø·: 0</div>
    <div id="hpDisplay">Ø§Ù„ØµØ­Ø©: â¤ï¸â¤ï¸â¤ï¸</div>
    <div id="weaponDisplay">Ø§Ù„Ø³Ù„Ø§Ø­: Ù…Ø³Ø¯Ø³ Ø£Ø³Ø§Ø³ÙŠ</div>
</div>

<div id="gameOverScreen">
    <div class="screenContent">
        <h2>Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø©!</h2>
        <p id="finalScore">Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©: 0</p>
        <button id="restartBtn" class="gameBtn">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù„Ø¹Ø¨</button>
        <button id="menuBtn" class="gameBtn">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
    </div>
</div>

<div id="pauseScreen">
    <div class="screenContent">
        <h2>Ø§Ù„Ù„Ø¹Ø¨Ø© Ù…ØªÙˆÙ‚ÙØ©</h2>
        <button id="resumeBtn" class="gameBtn">Ø§Ø³ØªØ¦Ù†Ø§Ù Ø§Ù„Ù„Ø¹Ø¨</button>
        <button id="restartBtn2" class="gameBtn">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù„Ø¹Ø¨</button>
    </div>
</div>

<div id="left" class="btn">â—€</div>
<div id="right" class="btn">â–¶</div>
<div id="up" class="btn">â–²</div>
<div id="down" class="btn">â–¼</div>
<div id="fire" class="btn">ğŸ”¥</div>
<div id="pauseBtn" class="btn">â¸</div>

<div id="controlsInfo">
    Ø§Ø¶ØºØ· Ù„ÙØªØ±Ø© Ø·ÙˆÙŠÙ„Ø© Ù„Ø§Ø·Ù„Ø§Ù‚ Ø§Ù„Ù†Ø§Ø± Ø§Ù„Ù…Ø³ØªÙ…Ø±
</div>

<script>
// Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¹Ù†Ø§ØµØ± DOM
const c = document.getElementById("game");
const ctx = c.getContext("2d");
const scoreDisplay = document.getElementById("scoreDisplay");
const hpDisplay = document.getElementById("hpDisplay");
const weaponDisplay = document.getElementById("weaponDisplay");
const gameOverScreen = document.getElementById("gameOverScreen");
const pauseScreen = document.getElementById("pauseScreen");
const finalScore = document.getElementById("finalScore");
const restartBtn = document.getElementById("restartBtn");
const restartBtn2 = document.getElementById("restartBtn2");
const menuBtn = document.getElementById("menuBtn");
const resumeBtn = document.getElementById("resumeBtn");
const pauseBtn = document.getElementById("pauseBtn");

// Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©
let player = { 
    x: 180, y: 500, w: 24, h: 24, 
    hp: 5, maxHp: 5,
    speed: 4,
    weapon: "basic", // Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø£Ø³Ù„Ø­Ø©: basic, dual, laser, spread
    weaponLevel: 1,
    fireRate: 300, // ÙˆÙ‚Øª Ø¨ÙŠÙ† ÙƒÙ„ Ø·Ù„Ù‚Ø© (Ø¨Ø§Ù„Ù…ÙŠÙ„ÙŠ Ø«Ø§Ù†ÙŠØ©)
    lastShot: 0,
    shield: 0, // Ø¯Ø±Ø¹ ÙˆØ§Ù‚ÙŠ (0-100)
    score: 0,
    combo: 0,
    lastEnemyHitTime: 0
};

let bullets = [];
let enemyBullets = [];
let enemies = [];
let upgrades = [];
let particles = [];
let keys = {};
let gameRunning = true;
let gamePaused = false;
let backgroundStars = [];
let bossActive = false;
let boss = null;
let rapidFire = false;

// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¬ÙˆÙ… ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©
for (let i = 0; i < 100; i++) {
    backgroundStars.push({
        x: Math.random() * c.width,
        y: Math.random() * c.height,
        size: Math.random() * 2 + 0.5,
        speed: Math.random() * 1 + 0.2
    });
}

// Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¡
const enemyTypes = [
    { name: "Ø¹Ø§Ø¯ÙŠ", hp: 2, color: "#00aa00", speed: 1.5, score: 10, msg: "Ø³Ø£Ø¯Ù…Ø±Ùƒ" },
    { name: "Ø³Ø±ÙŠØ¹", hp: 1, color: "#00ffff", speed: 3, score: 15, msg: "Ø£Ø±Ø§Ùƒ" },
    { name: "Ù‚ÙˆÙŠ", hp: 4, color: "#ffaa00", speed: 1, score: 25, msg: "Ù„Ù† ØªÙ†Ø¬Ùˆ" },
    { name: "Ù…Ø·Ù„Ù‚ Ù†Ø§Ø±", hp: 3, color: "#ff5555", speed: 1.2, score: 30, msg: "Ø®Ø° Ø±ØµØ§ØµØªÙŠ" }
];

// Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª
const upgradeTypes = [
    { type: "health", color: "#ff0000", chance: 0.3 },
    { type: "weapon", color: "#00ff00", chance: 0.3 },
    { type: "shield", color: "#0088ff", chance: 0.2 },
    { type: "speed", color: "#ffff00", chance: 0.2 }
];

// Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø£Ø³Ù„Ø­Ø©
const weapons = {
    basic: { name: "Ù…Ø³Ø¯Ø³ Ø£Ø³Ø§Ø³ÙŠ", bullets: 1, spread: 0, color: "yellow" },
    dual: { name: "Ù…Ø³Ø¯Ø³ Ù…Ø²Ø¯ÙˆØ¬", bullets: 2, spread: 0.2, color: "orange" },
    spread: { name: "Ø±Ø´Ø§Ø´ Ù…ØªÙØ±Ù‚", bullets: 5, spread: 0.5, color: "red" },
    laser: { name: "Ù„ÙŠØ²Ø±", bullets: 1, spread: 0, color: "#00ffff", laser: true }
};

// ÙˆØ¸ÙŠÙØ© Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ø¯Ùˆ
function spawnEnemy() {
    if (!gameRunning || gamePaused) return;
    
    // ÙØ±ØµØ© 5% Ù„Ø¸Ù‡ÙˆØ± Ø²Ø¹ÙŠÙ… (Ø¨ÙˆØ³) Ø¹Ù†Ø¯ ØªØ­Ù‚ÙŠÙ‚ 500 Ù†Ù‚Ø·Ø©
    if (!bossActive && player.score >= 500 && Math.random() < 0.05) {
        spawnBoss();
        return;
    }
    
    // Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ù„Ù„Ø¹Ø¯Ùˆ
    const typeIndex = Math.random() < 0.6 ? 0 : 
                     Math.random() < 0.7 ? 1 : 
                     Math.random() < 0.8 ? 2 : 3;
    
    const type = enemyTypes[typeIndex];
    
    const enemy = {
        x: Math.random() * (c.width - 30),
        y: -30,
        w: typeIndex === 3 ? 25 : 20,
        h: typeIndex === 3 ? 25 : 20,
        hp: type.hp,
        maxHp: type.hp,
        speed: type.speed,
        type: typeIndex,
        color: type.color,
        score: type.score,
        msg: type.msg,
        lastShot: 0,
        shootDelay: typeIndex === 3 ? 1500 : 0 // Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¡ Ù…Ù† Ø§Ù„Ù†ÙˆØ¹ 3 ÙŠØ·Ù„Ù‚ÙˆÙ† Ø§Ù„Ù†Ø§Ø±
    };
    
    enemies.push(enemy);
}

// ÙˆØ¸ÙŠÙØ© Ø¥Ù†Ø´Ø§Ø¡ Ø²Ø¹ÙŠÙ… (Ø¨ÙˆØ³)
function spawnBoss() {
    bossActive = true;
    boss = {
        x: c.width / 2 - 50,
        y: -100,
        w: 100,
        h: 60,
        hp: 50,
        maxHp: 50,
        speed: 0.5,
        phase: 1,
        lastShot: 0,
        shootDelay: 800,
        moveDirection: 1,
        color: "#ff00ff"
    };
    
    enemies.push(boss);
}

// ÙˆØ¸ÙŠÙØ© Ø¥Ù†Ø´Ø§Ø¡ ØªØ­Ø¯ÙŠØ« (Ø¨Ø§ÙˆØ± Ø£Ø¨)
function spawnUpgrade(x, y) {
    // ÙØ±ØµØ© 20% Ù„Ø¥Ø³Ù‚Ø§Ø· ØªØ­Ø¯ÙŠØ« Ø¹Ù†Ø¯ ØªØ¯Ù…ÙŠØ± Ø¹Ø¯Ùˆ
    if (Math.random() > 0.2) return;
    
    // ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø­ØªÙ…Ø§Ù„Ø§Øª
    let rand = Math.random();
    let cumulativeChance = 0;
    let selectedType;
    
    for (const upgrade of upgradeTypes) {
        cumulativeChance += upgrade.chance;
        if (rand <= cumulativeChance) {
            selectedType = upgrade.type;
            break;
        }
    }
    
    upgrades.push({
        x: x,
        y: y,
        type: selectedType,
        color: upgradeTypes.find(u => u.type === selectedType).color,
        w: 15,
        h: 15,
        speed: 1.5
    });
}

// ÙˆØ¸ÙŠÙØ© Ø¥Ø·Ù„Ø§Ù‚ Ø§Ù„Ù†Ø§Ø±
function shoot() {
    if (!gameRunning || gamePaused) return;
    
    const now = Date.now();
    if (now - player.lastShot < player.fireRate && !rapidFire) return;
    
    player.lastShot = now;
    
    const weapon = weapons[player.weapon];
    
    // Ø¥Ù†Ø´Ø§Ø¡ Ø±ØµØ§ØµØ§Øª Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù†ÙˆØ¹ Ø§Ù„Ø³Ù„Ø§Ø­
    if (weapon.laser) {
        // Ø³Ù„Ø§Ø­ Ø§Ù„Ù„ÙŠØ²Ø±
        bullets.push({
            x: player.x + player.w/2 - 2,
            y: player.y,
            w: 4,
            h: 20,
            color: weapon.color,
            speed: 10,
            laser: true
        });
    } else {
        // Ø§Ù„Ø£Ø³Ù„Ø­Ø© Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©
        for (let i = 0; i < weapon.bullets; i++) {
            const spread = (weapon.spread * (i - (weapon.bullets - 1) / 2));
            
            bullets.push({
                x: player.x + player.w/2 - 2 + spread * 10,
                y: player.y,
                w: 4,
                h: 12,
                color: weapon.color,
                speed: 8,
                laser: false
            });
        }
    }
    
    // ØªØ£Ø«ÙŠØ± Ø¬Ø³ÙŠÙ…ÙŠ Ø¹Ù†Ø¯ Ø¥Ø·Ù„Ø§Ù‚ Ø§Ù„Ù†Ø§Ø±
    createParticles(player.x + player.w/2, player.y + player.h, 5, weapon.color);
}

// ÙˆØ¸ÙŠÙØ© Ø¥Ø·Ù„Ø§Ù‚ Ø§Ù„Ù†Ø§Ø± Ù„Ù„Ø£Ø¹Ø¯Ø§Ø¡
function enemyShoot(enemy) {
    if (!gameRunning || gamePaused) return;
    
    const now = Date.now();
    if (now - enemy.lastShot < enemy.shootDelay) return;
    
    enemy.lastShot = now;
    
    // Ø²Ø¹ÙŠÙ… ÙŠØ·Ù„Ù‚ Ù†Ù…Ø· Ø±ØµØ§Øµ Ù…Ø®ØªÙ„Ù
    if (enemy === boss) {
        // Ø§Ù„Ø²Ø¹ÙŠÙ… ÙŠØ·Ù„Ù‚ 3 Ø±ØµØ§ØµØ§Øª Ø¨Ø§ØªØ¬Ø§Ù‡Ø§Øª Ù…Ø®ØªÙ„ÙØ©
        for (let i = -1; i <= 1; i++) {
            enemyBullets.push({
                x: enemy.x + enemy.w/2 - 3,
                y: enemy.y + enemy.h,
                w: 6,
                h: 12,
                color: "#ff9900",
                speed: 3,
                direction: i * 0.3
            });
        }
    } else {
        // Ø§Ù„Ø¹Ø¯Ùˆ Ø§Ù„Ø¹Ø§Ø¯ÙŠ ÙŠØ·Ù„Ù‚ Ø±ØµØ§ØµØ© ÙˆØ§Ø­Ø¯Ø©
        enemyBullets.push({
            x: enemy.x + enemy.w/2 - 3,
            y: enemy.y + enemy.h,
            w: 6,
            h: 12,
            color: "#ff9900",
            speed: 3,
            direction: 0
        });
    }
}

// ÙˆØ¸ÙŠÙØ© Ø¥Ù†Ø´Ø§Ø¡ ØªØ£Ø«ÙŠØ±Ø§Øª Ø¬Ø³ÙŠÙ…ÙŠØ©
function createParticles(x, y, count, color) {
    for (let i = 0; i < count; i++) {
        particles.push({
            x: x,
            y: y,
            size: Math.random() * 3 + 1,
            color: color || "#ffffff",
            speedX: (Math.random() - 0.5) * 4,
            speedY: Math.random() * -3 - 1,
            life: 30
        });
    }
}

// ÙˆØ¸ÙŠÙØ© Ø§Ù„ÙƒØ´Ù Ø¹Ù† Ø§Ù„ØªØµØ§Ø¯Ù…
function hit(a, b) {
    return a.x < b.x + b.w && 
           a.x + a.w > b.x &&
           a.y < b.y + b.h && 
           a.y + a.h > b.y;
}

// ÙˆØ¸ÙŠÙØ© Ø±Ø³Ù… Ø§Ù„Ø®Ù„ÙÙŠØ©
function drawBackground() {
    // Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø³ÙˆØ¯Ø§Ø¡
    ctx.fillStyle = "#000";
    ctx.fillRect(0, 0, c.width, c.height);
    
    // Ø§Ù„Ù†Ø¬ÙˆÙ…
    ctx.fillStyle = "white";
    for (const star of backgroundStars) {
        star.y += star.speed;
        if (star.y > c.height) {
            star.y = 0;
            star.x = Math.random() * c.width;
        }
        
        ctx.beginPath();
        ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
        ctx.fill();
    }
    
    // ØªØ£Ø«ÙŠØ± Ø§Ù„ØªÙˆÙ‡Ø¬ ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©
    const gradient = ctx.createRadialGradient(
        c.width/2, c.height/2, 10,
        c.width/2, c.height/2, 300
    );
    gradient.addColorStop(0, "rgba(0, 50, 100, 0.1)");
    gradient.addColorStop(1, "rgba(0, 0, 0, 0)");
    
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, c.width, c.height);
}

// ÙˆØ¸ÙŠÙØ© Ø±Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨
function drawPlayer() {
    // Ø¯Ø±Ø¹ Ø§Ù„Ù„Ø§Ø¹Ø¨
    if (player.shield > 0) {
        ctx.strokeStyle = `rgba(0, 150, 255, ${player.shield / 100})`;
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.arc(
            player.x + player.w/2,
            player.y + player.h/2,
            player.w/2 + 5,
            0, Math.PI * 2
        );
        ctx.stroke();
    }
    
    // Ø¬Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨
    const gradient = ctx.createLinearGradient(
        player.x, player.y,
        player.x, player.y + player.h
    );
    gradient.addColorStop(0, "#ff3333");
    gradient.addColorStop(1, "#990000");
    
    ctx.fillStyle = gradient;
    ctx.fillRect(player.x, player.y, player.w, player.h);
    
    // ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨
    ctx.fillStyle = "#ff6666";
    ctx.fillRect(player.x + 5, player.y + 5, player.w - 10, 4);
    ctx.fillRect(player.x + 5, player.y + player.h - 9, player.w - 10, 4);
}

// ÙˆØ¸ÙŠÙØ© Ø±Ø³Ù… Ø§Ù„Ø±ØµØ§ØµØ§Øª
function drawBullets() {
    bullets.forEach(b => {
        b.y -= b.speed;
        
        if (b.laser) {
            // Ø±Ø³Ù… Ø§Ù„Ù„ÙŠØ²Ø±
            ctx.fillStyle = b.color;
            ctx.fillRect(b.x, b.y, b.w, b.h);
            
            // ØªØ£Ø«ÙŠØ± ØªÙˆÙ‡Ø¬ Ù„Ù„Ù„ÙŠØ²Ø±
            ctx.shadowColor = b.color;
            ctx.shadowBlur = 10;
            ctx.fillRect(b.x, b.y, b.w, b.h);
            ctx.shadowBlur = 0;
        } else {
            // Ø§Ù„Ø±ØµØ§Øµ Ø§Ù„Ø¹Ø§Ø¯ÙŠ
            ctx.fillStyle = b.color;
            ctx.fillRect(b.x, b.y, b.w, b.h);
        }
    });
    
    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø±ØµØ§ØµØ§Øª Ø§Ù„ØªÙŠ Ø®Ø±Ø¬Øª Ø¹Ù† Ø§Ù„Ø´Ø§Ø´Ø©
    bullets = bullets.filter(b => b.y > -20);
}

// ÙˆØ¸ÙŠÙØ© Ø±Ø³Ù… Ø±ØµØ§ØµØ§Øª Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¡
function drawEnemyBullets() {
    enemyBullets.forEach(b => {
        b.y += b.speed;
        b.x += b.direction * 2;
        
        ctx.fillStyle = b.color;
        ctx.fillRect(b.x, b.y, b.w, b.h);
        
        // ØªØ£Ø«ÙŠØ± Ø¬Ø³ÙŠÙ…ÙŠ Ù„Ù„Ø±ØµØ§ØµØ©
        ctx.fillStyle = `rgba(255, 200, 0, 0.7)`;
        ctx.beginPath();
        ctx.arc(b.x + b.w/2, b.y + b.h/2, b.w/2 + 1, 0, Math.PI * 2);
        ctx.fill();
        
        // ØªØµØ§Ø¯Ù… Ù…Ø¹ Ø§Ù„Ù„Ø§Ø¹Ø¨
        if (hit(b, player)) {
            if (player.shield > 0) {
                player.shield -= 20;
                if (player.shield < 0) player.shield = 0;
            } else {
                player.hp--;
                createParticles(player.x + player.w/2, player.y + player.h/2, 10, "#ff0000");
            }
            b.y = c.height + 10; // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø±ØµØ§ØµØ©
        }
    });
    
    enemyBullets = enemyBullets.filter(b => b.y < c.height + 20);
}

// ÙˆØ¸ÙŠÙØ© Ø±Ø³Ù… Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¡
function drawEnemies() {
    enemies.forEach(e => {
        // ØªØ­Ø¯ÙŠØ« Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¹Ø¯Ùˆ
        e.y += e.speed;
        
        // Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¡ Ù…Ù† Ø§Ù„Ù†ÙˆØ¹ 3 ÙˆØ§Ù„Ø²Ø¹ÙŠÙ… ÙŠØ·Ù„Ù‚ÙˆÙ† Ø§Ù„Ù†Ø§Ø±
        if (e.type === 3 || e === boss) {
            enemyShoot(e);
        }
        
        // Ø±Ø³Ù… Ø§Ù„Ø¹Ø¯Ùˆ
        if (e === boss) {
            // Ø±Ø³Ù… Ø§Ù„Ø²Ø¹ÙŠÙ…
            ctx.fillStyle = e.color;
            ctx.fillRect(e.x, e.y, e.w, e.h);
            
            // ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø²Ø¹ÙŠÙ…
            ctx.fillStyle = "#ffccff";
            ctx.fillRect(e.x + 10, e.y + 10, e.w - 20, 10);
            ctx.fillRect(e.x + 10, e.y + e.h - 20, e.w - 20, 10);
            
            // Ø´Ø±ÙŠØ· ØµØ­Ø© Ø§Ù„Ø²Ø¹ÙŠÙ…
            const healthWidth = (e.hp / e.maxHp) * (e.w - 20);
            ctx.fillStyle = "#ff0000";
            ctx.fillRect(e.x + 10, e.y - 10, e.w - 20, 5);
            ctx.fillStyle = "#00ff00";
            ctx.fillRect(e.x + 10, e.y - 10, healthWidth, 5);
            
            // ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø²Ø¹ÙŠÙ… ÙŠÙ…ÙŠÙ†Ù‹Ø§ ÙˆÙŠØ³Ø§Ø±Ù‹Ø§
            e.x += e.moveDirection;
            if (e.x <= 0 || e.x + e.w >= c.width) {
                e.moveDirection *= -1;
            }
        } else {
            // Ø±Ø³Ù… Ø§Ù„Ø¹Ø¯Ùˆ Ø§Ù„Ø¹Ø§Ø¯ÙŠ
            ctx.fillStyle = e.color;
            ctx.fillRect(e.x, e.y, e.w, e.h);
            
            // Ù†Øµ Ø§Ù„Ø¹Ø¯Ùˆ
            ctx.fillStyle = "white";
            ctx.font = "10px Arial";
            ctx.fillText(e.msg, e.x - 5, e.y - 5);
            
            // Ø´Ø±ÙŠØ· Ø§Ù„ØµØ­Ø©
            if (e.hp < e.maxHp) {
                const healthWidth = (e.hp / e.maxHp) * e.w;
                ctx.fillStyle = "#ff0000";
                ctx.fillRect(e.x, e.y - 5, e.w, 3);
                ctx.fillStyle = "#00ff00";
                ctx.fillRect(e.x, e.y - 5, healthWidth, 3);
            }
        }
        
        // ØªØµØ§Ø¯Ù… Ø§Ù„Ø±ØµØ§Øµ Ù…Ø¹ Ø§Ù„Ø¹Ø¯Ùˆ
        bullets.forEach(b => {
            if (hit(b, e)) {
                e.hp--;
                b.y = -10; // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø±ØµØ§ØµØ©
                
                // ØªØ£Ø«ÙŠØ± Ø¬Ø³ÙŠÙ…ÙŠ Ø¹Ù†Ø¯ Ø§Ù„Ø§ØµØ·Ø¯Ø§Ù…
                createParticles(e.x + e.w/2, e.y + e.h/2, 8, e.color);
                
                // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ÙƒÙˆÙ…Ø¨Ùˆ
                player.combo++;
                player.lastEnemyHitTime = Date.now();
                
                if (e.hp <= 0) {
                    // ØªØ¯Ù…ÙŠØ± Ø§Ù„Ø¹Ø¯Ùˆ
                    player.score += e.score;
                    
                    // Ù…ÙƒØ§ÙØ£Ø© Ø§Ù„ÙƒÙˆÙ…Ø¨Ùˆ
                    if (player.combo >= 5) {
                        const comboBonus = Math.floor(player.combo / 5) * 10;
                        player.score += comboBonus;
                    }
                    
                    // Ø¥Ù†Ø´Ø§Ø¡ ØªØ­Ø¯ÙŠØ«Ø§Øª
                    spawnUpgrade(e.x + e.w/2, e.y + e.h/2);
                    
                    // ØªØ£Ø«ÙŠØ± Ø§Ù†ÙØ¬Ø§Ø± Ø¹Ù†Ø¯ ØªØ¯Ù…ÙŠØ± Ø§Ù„Ø¹Ø¯Ùˆ
                    createParticles(e.x + e.w/2, e.y + e.h/2, 15, "#ffaa00");
                    
                    // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ø²Ø¹ÙŠÙ…
                    if (e === boss) {
                        player.score += 500; // Ù…ÙƒØ§ÙØ£Ø© ÙƒØ¨ÙŠØ±Ø© Ù„Ù‡Ø²ÙŠÙ…Ø© Ø§Ù„Ø²Ø¹ÙŠÙ…
                        bossActive = false;
                        boss = null;
                    }
                }
            }
        });
        
        // ØªØµØ§Ø¯Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ Ù…Ø¹ Ø§Ù„Ø¹Ø¯Ùˆ
        if (hit(player, e)) {
            if (player.shield > 0) {
                player.shield -= 30;
                if (player.shield < 0) player.shield = 0;
            } else {
                player.hp--;
                player.combo = 0; // Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„ÙƒÙˆÙ…Ø¨Ùˆ
            }
            
            e.hp = 0; // ØªØ¯Ù…ÙŠØ± Ø§Ù„Ø¹Ø¯Ùˆ
            createParticles(e.x + e.w/2, e.y + e.h/2, 15, "#ff0000");
        }
    });
    
    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¡ Ø§Ù„Ù…Ø¯Ù…Ø±ÙŠÙ† Ø£Ùˆ Ø§Ù„Ø°ÙŠÙ† Ø®Ø±Ø¬ÙˆØ§ Ø¹Ù† Ø§Ù„Ø´Ø§Ø´Ø©
    enemies = enemies.filter(e => e.hp > 0 && e.y < c.height + 50);
}

// ÙˆØ¸ÙŠÙØ© Ø±Ø³Ù… Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª
function drawUpgrades() {
    upgrades.forEach(u => {
        u.y += u.speed;
        
        // Ø±Ø³Ù… Ø§Ù„ØªØ­Ø¯ÙŠØ«
        ctx.fillStyle = u.color;
        ctx.beginPath();
        ctx.arc(u.x, u.y, u.w/2, 0, Math.PI * 2);
        ctx.fill();
        
        // ØªØ£Ø«ÙŠØ± ØªÙˆÙ‡Ø¬
        ctx.shadowColor = u.color;
        ctx.shadowBlur = 10;
        ctx.beginPath();
        ctx.arc(u.x, u.y, u.w/2, 0, Math.PI * 2);
        ctx.fill();
        ctx.shadowBlur = 0;
        
        // Ù†Øµ Ø§Ù„ØªØ­Ø¯ÙŠØ«
        ctx.fillStyle = "white";
        ctx.font = "8px Arial";
        let text = "";
        if (u.type === "health") text = "â¤ï¸";
        else if
